var RegistrationStep0,__bind=function(t,i){return function(){return t.apply(i,arguments)}};RegistrationStep0=function(){function t(){this.backToForm=__bind(this.backToForm,this),this.formSubmited=__bind(this.formSubmited,this),this.formSubmit=__bind(this.formSubmit,this),this.smsSubmit=__bind(this.smsSubmit,this),this.validate=__bind(this.validate,this),this.selectRegion=__bind(this.selectRegion,this),this.hideRegionsList=__bind(this.hideRegionsList,this),this.showRegionsList=__bind(this.showRegionsList,this),this.hideRegistrationPopup=__bind(this.hideRegistrationPopup,this),this.showRegistrationPopup=__bind(this.showRegistrationPopup,this),this.filterCity=__bind(this.filterCity,this);var t,i,s;if(this.itype="click",$("html").hasClass("touch")&&(this.itype="touchstart"),this.widget=$(".registration-step-0"),1!==this.widget.length)throw{error:"не найден виджет"};$(".h5-phone").mask("+7 (999) 999-99-99"),this.form_registration=this.widget.find(".registration"),this.form_sms=this.widget.find(".sms"),this.form_sms_title=this.form_sms.find(">.title"),this.submit=this.form_registration.find("button"),t=this.widget.find("input"),t.on("keyup",this.inputChange),t.on("blur",this.inputChange),t.on("change",this.inputChange),this.form_sms_title.on("click",this.backToForm),this.regions_input=$("#reg-region"),this.regions_list=this.widget.find(".regions-list"),this.regions_list_item=this.regions_list.find(".item"),this.regions_list_search=this.regions_list.find("input"),this.regions_list_close=this.regions_list.find(".regions-list-close"),this.regions_list_search.on("keyup",this.filterCity),this.regions_list_search.on("change",this.filterCity),this.regions_list_close.on(this.itype,this.hideRegionsList),$("body").on("click",".regions-list .regions a",this.selectRegion),i=this.widget.find('[for="reg-region"], .change-region'),i.on(this.itype+" focus",this.showRegionsList),this.regions_input.on(this.itype+" focus",this.showRegionsList),this.form_registration.h5Validate(),this.submit.on("click",this.formSubmit),this.form_sms.h5Validate(),this.form_sms.find('button[type="submit"]').on("click",this.smsSubmit),$("a.register").on(this.itype,this.showRegistrationPopup),this.widget.find(".registration-step-0-close").on(this.itype,this.hideRegistrationPopup),$("html").hasClass("no-cssvhunit")&&(s=Math.max(document.documentElement.clientHeight,window.innerHeight||0),this.widget.css({height:s,"line-height":s}),Modernizr.mq("screen and (max-width:600px)")||this.regions_list.css({"max-height":.8*s}))}return t.prototype.filterCity=function(){var t;return this.regions_list_item.show(),t=this.regions_list_search.val().trim(),0!==t.length?this.regions_list.find('.item:not(:contains("'+t+'"))').hide():void 0},t.prototype.showRegistrationPopup=function(t){return t.preventDefault(),this.widget.stop().fadeIn(),this.widget.addClass("open")},t.prototype.hideRegistrationPopup=function(t){return t.preventDefault(),this.widget.stop().fadeOut(),this.form_registration[0].reset(),this.form_sms[0].reset(),this.regions_input.removeClass("changed"),this.regions_list_search.val(""),this.widget.removeClass("open")},t.prototype.showRegionsList=function(t){return t.preventDefault(),this.regions_list.show(),this.regions_list_item.show(),this.regions_list_search[0].focus()},t.prototype.hideRegionsList=function(t){return t.preventDefault(),this.regions_list.hide(),this.submit.focus(),this.regions_list_search.val(""),this.regions_list_item.show()},t.prototype.selectRegion=function(t){return t.preventDefault(),this.regions_input.val(t.currentTarget.getAttribute("data-title")),this.regions_input.blur(),this.regions_list.hide(),this.submit.focus(),this.regions_list_search.val(""),this.regions_list_item.show()},t.prototype.inputChange=function(t){var i,s;return i=$(t.currentTarget),s=i.val().trim(),0===s.length||"+7 (___) ___-__-__"===s?i.toggleClass("changed",!1):i.toggleClass("changed",!0)},t.prototype.validate=function(t){var i;return t.hasAttribute("required")&&0===t.value.trim().length&&t.classList.add("ui-state-error"),t.classList.contains("ui-state-error")?(t.hasAttribute("data-h5-errorid")&&(i=document.getElementById(t.getAttribute("data-h5-errorid")),i.style.display="block"),!1):!0},t.prototype.smsSubmit=function(t){var i,s,e,r;for(s=this.form_sms.find("input, select, textarea"),e=0,r=s.length;r>e;e++)if(i=s[e],!this.validate(i))return!1;return this.form_sms.find(".ui-state-error").length>0?void 0:(t.preventDefault(),$.ajax({type:"POST",url:this.form_sms.attr("data-action"),data:this.form_sms.find(":input").serialize(),success:this.formSubmited,fail:this.formSubmited,complete:this.formSubmited,dataType:"json"}),this.form_sms.find("input, select, textarea").val(""))},t.prototype.formSubmit=function(t){var i,s,e,r;for(s=this.form_registration.find("input, select, textarea"),e=0,r=s.length;r>e;e++)if(i=s[e],!this.validate(i))return!1;return this.form_registration.find(".ui-state-error").length>0?void 0:(t.preventDefault(),$.ajax({type:"POST",url:this.form_registration.attr("data-action"),data:this.form_registration.find(":input").serialize(),success:this.formSubmited,fail:this.formSubmited,complete:this.formSubmited,dataType:"json"}),this.regions_input.removeClass("changed").removeClass("ui-state-error"),this.form_registration.find("input, select, textarea").val(""))},t.prototype.formSubmited=function(){return this.form_registration.find("input").each(function(t,i){return $(i).removeClass("changed").removeClass("ui-state-error")}),this.form_registration.fadeOut(),this.form_sms.fadeIn()},t.prototype.backToForm=function(){return this.form_registration.fadeIn(),this.form_sms.fadeOut()},t}(),$(document).ready(function(){return new RegistrationStep0});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlJlZ2lzdHJhdGlvblN0ZXAwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxHQUFBLG1CQUFBLE9BQUEsU0FBQSxFQUFBLEdBQUEsTUFBQSxZQUFBLE1BQUEsR0FBQSxNQUFBLEVBQUEsWUFBQSxtQkFBQSxXQUNlLFFBQUEsS0FFWCxLQUFBLFdBQUEsT0FBQSxLQUFBLFdBQUEsTUFBQSxLQUFBLGFBQUEsT0FBQSxLQUFBLGFBQUEsTUFBQSxLQUFBLFdBQUEsT0FBQSxLQUFBLFdBQUEsTUFBQSxLQUFBLFVBQUEsT0FBQSxLQUFBLFVBQUEsTUFBQSxLQUFBLFNBQUEsT0FBQSxLQUFBLFNBQUEsTUFBQSxLQUFBLGFBQUEsT0FBQSxLQUFBLGFBQUEsTUFBQSxLQUFBLGdCQUFBLE9BQUEsS0FBQSxnQkFBQSxNQUFBLEtBQUEsZ0JBQUEsT0FBQSxLQUFBLGdCQUFBLE1BQUEsS0FBQSxzQkFBQSxPQUFBLEtBQUEsc0JBQUEsTUFBQSxLQUFBLHNCQUFBLE9BQUEsS0FBQSxzQkFBQSxNQUFBLEtBQUEsV0FBQSxPQUFBLEtBQUEsV0FBQSxLQUFBLElBQUEsR0FBQSxFQUFBLENBTUEsSUFOQSxLQUFDLE1BQVEsUUFDTixFQUFFLFFBQVEsU0FBUyxXQUNwQixLQUFDLE1BQVEsY0FFWCxLQUFDLE9BQVMsRUFBRSx3QkFFUyxJQUFsQixLQUFDLE9BQU8sT0FDVCxNQUFPLE1BQU8sbUJBRWhCLEdBQUUsYUFBYSxLQUFLLHNCQUVwQixLQUFDLGtCQUFvQixLQUFDLE9BQU8sS0FBSyxpQkFDbEMsS0FBQyxTQUFXLEtBQUMsT0FBTyxLQUFLLFFBQ3pCLEtBQUMsZUFBaUIsS0FBQyxTQUFTLEtBQUssV0FDakMsS0FBQyxPQUFTLEtBQUMsa0JBQWtCLEtBQUssVUFDbEMsRUFBUyxLQUFDLE9BQU8sS0FBSyxTQUN0QixFQUFPLEdBQUcsUUFBUyxLQUFDLGFBQ3BCLEVBQU8sR0FBRyxPQUFRLEtBQUMsYUFDbkIsRUFBTyxHQUFHLFNBQVUsS0FBQyxhQUNyQixLQUFD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LFVBOEtBLGFBQWMsaUJBQ1osTUFBQyxrQkFBa0IsS0FBSyxTQUFTLEtBQUssU0FBQyxFQUFPLFNBQzVDLEdBQUUsR0FBUyxZQUFZLFdBQVcsWUFBWSxvQkFDaEQsS0FBQyxrQkFBa0IsVUFDbkIsS0FBQyxTQUFTLFVBbExaLEVBQUEsVUFvTEEsV0FBWSxpQkFDVixNQUFDLGtCQUFrQixTQUNuQixLQUFDLFNBQVMsZ0JBdkxkLEVBeUxFLFVBQVUsTUFBTSxpQkFDWixJQUFBIiwiZmlsZSI6IlJlZ2lzdHJhdGlvblN0ZXAwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgUmVnaXN0cmF0aW9uU3RlcDBcbiAgY29uc3RydWN0b3I6IC0+XG5cbiAgICBAaXR5cGUgPSAnY2xpY2snXG4gICAgaWYgJCgnaHRtbCcpLmhhc0NsYXNzKCd0b3VjaCcpXG4gICAgICBAaXR5cGUgPSAndG91Y2hzdGFydCdcblxuICAgIEB3aWRnZXQgPSAkICcucmVnaXN0cmF0aW9uLXN0ZXAtMCdcblxuICAgIGlmIEB3aWRnZXQubGVuZ3RoICE9IDFcbiAgICAgIHRocm93IHtlcnJvcjogJ9C90LUg0L3QsNC50LTQtdC9INCy0LjQtNC20LXRgid9XG5cbiAgICAkKCcuaDUtcGhvbmUnKS5tYXNrIFwiKzcgKDk5OSkgOTk5LTk5LTk5XCJcblxuICAgIEBmb3JtX3JlZ2lzdHJhdGlvbiA9IEB3aWRnZXQuZmluZCAnLnJlZ2lzdHJhdGlvbidcbiAgICBAZm9ybV9zbXMgPSBAd2lkZ2V0LmZpbmQgJy5zbXMnXG4gICAgQGZvcm1fc21zX3RpdGxlID0gQGZvcm1fc21zLmZpbmQgJz4udGl0bGUnXG4gICAgQHN1Ym1pdCA9IEBmb3JtX3JlZ2lzdHJhdGlvbi5maW5kICdidXR0b24nXG4gICAgaW5wdXRzID0gQHdpZGdldC5maW5kICdpbnB1dCdcbiAgICBpbnB1dHMub24gJ2tleXVwJywgQGlucHV0Q2hhbmdlXG4gICAgaW5wdXRzLm9uICdibHVyJywgQGlucHV0Q2hhbmdlXG4gICAgaW5wdXRzLm9uICdjaGFuZ2UnLCBAaW5wdXRDaGFuZ2VcbiAgICBAZm9ybV9zbXNfdGl0bGUub24gJ2NsaWNrJywgQGJhY2tUb0Zvcm1cblxuICAgIEByZWdpb25zX2lucHV0ID0gJCAnI3JlZy1yZWdpb24nXG4gICAgQHJlZ2lvbnNfbGlzdCA9IEB3aWRnZXQuZmluZCAnLnJlZ2lvbnMtbGlzdCdcbiAgICBAcmVnaW9uc19saXN0X2l0ZW0gPSBAcmVnaW9uc19saXN0LmZpbmQgJy5pdGVtJ1xuICAgIEByZWdpb25zX2xpc3Rfc2VhcmNoID0gQHJlZ2lvbnNfbGlzdC5maW5kICdpbnB1dCdcbiAgICBAcmVnaW9uc19saXN0X2Nsb3NlID0gQHJlZ2lvbnNfbGlzdC5maW5kICcucmVnaW9ucy1saXN0LWNsb3NlJ1xuXG4gICAgQHJlZ2lvbnNfbGlzdF9zZWFyY2gub24gJ2tleXVwJywgQGZpbHRlckNpdHlcbiAgICBAcmVnaW9uc19saXN0X3NlYXJjaC5vbiAnY2hhbmdlJywgQGZpbHRlckNpdHlcbiAgICBAcmVnaW9uc19saXN0X2Nsb3NlLm9uIEBpdHlwZSwgQGhpZGVSZWdpb25zTGlzdFxuXG4gICAgJCgnYm9keScpLm9uICdjbGljaycsICcucmVnaW9ucy1saXN0IC5yZWdpb25zIGEnLCBAc2VsZWN0UmVnaW9uXG5cbiAgICByZWdpb25fY29udHJvbHMgPSBAd2lkZ2V0LmZpbmQgJ1tmb3I9XCJyZWctcmVnaW9uXCJdLCAuY2hhbmdlLXJlZ2lvbidcbiAgICByZWdpb25fY29udHJvbHMub24gQGl0eXBlKycgZm9jdXMnLCBAc2hvd1JlZ2lvbnNMaXN0XG4gICAgQHJlZ2lvbnNfaW5wdXQub24gQGl0eXBlKycgZm9jdXMnLCBAc2hvd1JlZ2lvbnNMaXN0XG5cbiAgICBAZm9ybV9yZWdpc3RyYXRpb24uaDVWYWxpZGF0ZSgpXG4gICAgIyBAZm9ybV9yZWdpc3RyYXRpb24ub24gJ3N1Ym1pdCcsIEBmb3JtU3VibWl0XG5cbiAgICBAc3VibWl0Lm9uICdjbGljaycsIEBmb3JtU3VibWl0XG5cbiAgICBAZm9ybV9zbXMuaDVWYWxpZGF0ZSgpXG4gICAgQGZvcm1fc21zLmZpbmQoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJykub24gJ2NsaWNrJywgQHNtc1N1Ym1pdFxuXG4gICAgJCgnYS5yZWdpc3RlcicpLm9uIEBpdHlwZSwgQHNob3dSZWdpc3RyYXRpb25Qb3B1cFxuXG4gICAgQHdpZGdldC5maW5kKCcucmVnaXN0cmF0aW9uLXN0ZXAtMC1jbG9zZScpLm9uIEBpdHlwZSxcbiAgICAgIEBoaWRlUmVnaXN0cmF0aW9uUG9wdXBcblxuICAgIGlmICQoJ2h0bWwnKS5oYXNDbGFzcyAnbm8tY3Nzdmh1bml0J1xuICAgICAgdmggPSBNYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LFxuICAgICAgICB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgMClcbiAgICAgIEB3aWRnZXQuY3NzXG4gICAgICAgICdoZWlnaHQnOiB2aFxuICAgICAgICAnbGluZS1oZWlnaHQnOiB2aFxuICAgICAgaWYgIU1vZGVybml6ci5tcShcInNjcmVlbiBhbmQgKG1heC13aWR0aDo2MDBweClcIilcbiAgICAgICAgQHJlZ2lvbnNfbGlzdC5jc3NcbiAgICAgICAgICAnbWF4LWhlaWdodCc6IDAuOCp2aFxuXG4gIGZpbHRlckNpdHk6IChldmVudCk9PlxuICAgIEByZWdpb25zX2xpc3RfaXRlbS5zaG93KClcbiAgICBrZXl3b3JkID0gQHJlZ2lvbnNfbGlzdF9zZWFyY2gudmFsKCkudHJpbSgpXG4gICAgaWYga2V5d29yZC5sZW5ndGg9PTBcbiAgICAgIHJldHVyblxuICAgIEByZWdpb25zX2xpc3QuZmluZCgnLml0ZW06bm90KDpjb250YWlucyhcIicra2V5d29yZCsnXCIpKScpLmhpZGUoKVxuXG4gIHNob3dSZWdpc3RyYXRpb25Qb3B1cDogKGV2ZW50KT0+XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgIEB3aWRnZXQuc3RvcCgpLmZhZGVJbigpXG4gICAgQHdpZGdldC5hZGRDbGFzcyAnb3BlbidcblxuICBoaWRlUmVnaXN0cmF0aW9uUG9wdXA6IChldmVudCk9PlxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICBAd2lkZ2V0LnN0b3AoKS5mYWRlT3V0KClcbiAgICBAZm9ybV9yZWdpc3RyYXRpb25bMF0ucmVzZXQoKVxuICAgIEBmb3JtX3Ntc1swXS5yZXNldCgpXG4gICAgQHJlZ2lvbnNfaW5wdXQucmVtb3ZlQ2xhc3MgJ2NoYW5nZWQnXG4gICAgQHJlZ2lvbnNfbGlzdF9zZWFyY2gudmFsICcnXG4gICAgQHdpZGdldC5yZW1vdmVDbGFzcyAnb3BlbidcblxuICBzaG93UmVnaW9uc0xpc3Q6IChldmVudCk9PlxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICBAcmVnaW9uc19saXN0LnNob3coKVxuICAgIEByZWdpb25zX2xpc3RfaXRlbS5zaG93KClcbiAgICBAcmVnaW9uc19saXN0X3NlYXJjaFswXS5mb2N1cygpXG5cbiAgaGlkZVJlZ2lvbnNMaXN0OiAoZXZlbnQpPT5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgQHJlZ2lvbnNfbGlzdC5oaWRlKClcbiAgICBAc3VibWl0LmZvY3VzKClcbiAgICBAcmVnaW9uc19saXN0X3NlYXJjaC52YWwgJydcbiAgICBAcmVnaW9uc19saXN0X2l0ZW0uc2hvdygpXG5cbiAgc2VsZWN0UmVnaW9uOiAoZXZlbnQpPT5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgQHJlZ2lvbnNfaW5wdXQudmFsIGV2ZW50LmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJylcbiAgICBAcmVnaW9uc19pbnB1dC5ibHVyKClcbiAgICBAcmVnaW9uc19saXN0LmhpZGUoKVxuICAgIEBzdWJtaXQuZm9jdXMoKVxuICAgIEByZWdpb25zX2xpc3Rfc2VhcmNoLnZhbCAnJ1xuICAgIEByZWdpb25zX2xpc3RfaXRlbS5zaG93KClcblxuICBpbnB1dENoYW5nZTogKGV2ZW50KS0+XG4gICAgaW5wdXQgPSAkIGV2ZW50LmN1cnJlbnRUYXJnZXRcbiAgICB2YWx1ZSA9IGlucHV0LnZhbCgpLnRyaW0oKVxuICAgIGlmIHZhbHVlLmxlbmd0aCA9PSAwIHx8IHZhbHVlID09ICcrNyAoX19fKSBfX18tX18tX18nXG4gICAgICBpbnB1dC50b2dnbGVDbGFzcyAnY2hhbmdlZCcsIGZhbHNlXG4gICAgZWxzZVxuICAgICAgaW5wdXQudG9nZ2xlQ2xhc3MgJ2NoYW5nZWQnLCB0cnVlXG5cbiAgdmFsaWRhdGU6IChpbnB1dCk9PlxuXG4gICAgaWYgaW5wdXQuaGFzQXR0cmlidXRlKCdyZXF1aXJlZCcpXG4gICAgICBpZiBpbnB1dC52YWx1ZS50cmltKCkubGVuZ3RoID09IDBcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCAndWktc3RhdGUtZXJyb3InXG5cbiAgICBpZiBpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMgJ3VpLXN0YXRlLWVycm9yJ1xuICAgICAgaWYgaW5wdXQuaGFzQXR0cmlidXRlICdkYXRhLWg1LWVycm9yaWQnXG4gICAgICAgIGVycm9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQgaW5wdXQuZ2V0QXR0cmlidXRlKCdkYXRhLWg1LWVycm9yaWQnKVxuICAgICAgICBlcnJvci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJ1xuICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICByZXR1cm4gdHJ1ZVxuXG4gIHNtc1N1Ym1pdDogKGV2ZW50KT0+XG4gICAgaW5wdXRzID0gQGZvcm1fc21zLmZpbmQoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhJylcbiAgICBmb3IgaW5wdXQgaW4gaW5wdXRzXG4gICAgICBpZiAhQHZhbGlkYXRlKGlucHV0KVxuICAgICAgICByZXR1cm4gZmFsc2VcblxuICAgIGlmIEBmb3JtX3Ntcy5maW5kKCcudWktc3RhdGUtZXJyb3InKS5sZW5ndGg+MFxuICAgICAgcmV0dXJuXG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgJC5hamF4XG4gICAgICB0eXBlOiBcIlBPU1RcIlxuICAgICAgdXJsOiBAZm9ybV9zbXMuYXR0cignZGF0YS1hY3Rpb24nKVxuICAgICAgZGF0YTogQGZvcm1fc21zLmZpbmQoXCI6aW5wdXRcIikuc2VyaWFsaXplKClcbiAgICAgIHN1Y2Nlc3M6IEBmb3JtU3VibWl0ZWRcbiAgICAgIGZhaWw6IEBmb3JtU3VibWl0ZWRcbiAgICAgIGNvbXBsZXRlOiBAZm9ybVN1Ym1pdGVkXG4gICAgICBkYXRhVHlwZTogJ2pzb24nXG5cbiAgICBAZm9ybV9zbXMuZmluZCgnaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEnKS52YWwoJycpXG5cblxuXG4gIGZvcm1TdWJtaXQ6IChldmVudCk9PlxuXG4gICAgaW5wdXRzID0gQGZvcm1fcmVnaXN0cmF0aW9uLmZpbmQoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhJylcbiAgICBmb3IgaW5wdXQgaW4gaW5wdXRzXG4gICAgICBpZiAhQHZhbGlkYXRlKGlucHV0KVxuICAgICAgICByZXR1cm4gZmFsc2VcblxuICAgIGlmIEBmb3JtX3JlZ2lzdHJhdGlvbi5maW5kKCcudWktc3RhdGUtZXJyb3InKS5sZW5ndGg+MFxuICAgICAgcmV0dXJuXG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgJC5hamF4XG4gICAgICB0eXBlOiBcIlBPU1RcIlxuICAgICAgdXJsOiBAZm9ybV9yZWdpc3RyYXRpb24uYXR0cignZGF0YS1hY3Rpb24nKVxuICAgICAgZGF0YTogQGZvcm1fcmVnaXN0cmF0aW9uLmZpbmQoXCI6aW5wdXRcIikuc2VyaWFsaXplKClcbiAgICAgIHN1Y2Nlc3M6IEBmb3JtU3VibWl0ZWRcbiAgICAgIGZhaWw6IEBmb3JtU3VibWl0ZWRcbiAgICAgIGNvbXBsZXRlOiBAZm9ybVN1Ym1pdGVkXG4gICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgQHJlZ2lvbnNfaW5wdXQucmVtb3ZlQ2xhc3MoJ2NoYW5nZWQnKS5yZW1vdmVDbGFzcygndWktc3RhdGUtZXJyb3InKVxuXG4gICAgIyBAZm9ybV9yZWdpc3RyYXRpb25bMF0ucmVzZXQoKVxuICAgIEBmb3JtX3JlZ2lzdHJhdGlvbi5maW5kKCdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScpLnZhbCgnJylcblxuICBmb3JtU3VibWl0ZWQ6IChkYXRhKT0+XG4gICAgQGZvcm1fcmVnaXN0cmF0aW9uLmZpbmQoJ2lucHV0JykuZWFjaCAoaW5kZXgsIGVsZW1lbnQpLT5cbiAgICAgICQoZWxlbWVudCkucmVtb3ZlQ2xhc3MoJ2NoYW5nZWQnKS5yZW1vdmVDbGFzcygndWktc3RhdGUtZXJyb3InKVxuICAgIEBmb3JtX3JlZ2lzdHJhdGlvbi5mYWRlT3V0KClcbiAgICBAZm9ybV9zbXMuZmFkZUluKClcblxuICBiYWNrVG9Gb3JtOiAoZXZlbnQpPT5cbiAgICBAZm9ybV9yZWdpc3RyYXRpb24uZmFkZUluKClcbiAgICBAZm9ybV9zbXMuZmFkZU91dCgpXG5cbiQoZG9jdW1lbnQpLnJlYWR5IC0+XG4gIG5ldyBSZWdpc3RyYXRpb25TdGVwMCgpIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9