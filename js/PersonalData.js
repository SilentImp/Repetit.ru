var PersonalData,__bind=function(e,t){return function(){return e.apply(t,arguments)}};PersonalData=function(){function e(){this.afterCheck=__bind(this.afterCheck,this),this.avatarSelected=__bind(this.avatarSelected,this),this.removeAvatar=__bind(this.removeAvatar,this),this.drop=__bind(this.drop,this),this.checkDate=__bind(this.checkDate,this);var e,t,i,r,a,n,o,s,d,c,l,u,h,f,p;if(this.form=$("form.panel"),1!==this.form.length)throw new Error("не найдена форма");if(this.file=this.form.find("#registration-avatar"),this.avatarTemplate=document.getElementById("current-avatar-template"),this.fileSelector=$(".file-selector"),FileAPI.event.on(document.getElementById("registration-avatar"),"change",this.avatarSelected),$(document).dnd(this.over,this.drop),FileAPI.event.on(document,"drop",this.droped),l=$(".sertificats"),l.length>0&&l.fileapi({url:"http://test.silentimp.info/test.php",duplicate:!1,accept:"image/*",maxSize:5*FileAPI.MB,autoUpload:!1,multiple:!0,onSelect:function(e){return function(t,i){var r;return e.cerificates_count++,r=new FileReader,r.onload=function(t){return e.cert_list.append(e.source({id:e.cerificates_count,src:t.target.result}))},r.readAsDataURL(i.files[0])}}(this),elements:{ctrl:{upload:".add-sertificat label"},list:".sertificat-list"}}),c=$("#sertificat-template"),c.length>0&&(this.source=$("#sertificat-template").html(),this.source=Handlebars.compile(this.source),this.cert_list=$(".sertificat-list"),this.cerificates_count=0),i=$(".lessons-format"),i.length>0){for(a=i.find("input"),f=0,p=a.length;p>f;f++)r=a[f],s=document.getElementById(r.getAttribute("data-price-field")),o=$(s).closest(".subdevision"),r.checked?(o.removeClass("hide"),s.removeAttribute("disabled"),s.setAttribute("required","required")):(o.addClass("hide"),s.classList.remove("ui-state-error"),s.setAttribute("disabled","disabled"),s.removeAttribute("required"));a.on("change",function(){return function(e){return r=$(e.currentTarget),s=document.getElementById(r.attr("data-price-field")),o=$(s).closest(".subdevision"),e.currentTarget.checked?(o.removeClass("hide"),s.removeAttribute("disabled"),s.setAttribute("required","required")):(o.addClass("hide"),s.classList.remove("ui-state-error"),s.setAttribute("disabled","disabled"),s.removeAttribute("required"))}}(this))}this.address=$(".address-holder"),this.address_count=0,this.address.length>0&&(this.address_count++,this.address_source=$("#address-template").html(),this.address_source=Handlebars.compile(this.address_source),this.address.prepend(this.address_source({id:this.address_count})),this.add_education=$(".add-address"),this.add_education.on("click",function(e){return function(t){return t.preventDefault(),e.address_count++,e.add_education.before(e.address_source({id:e.address_count})),e.address.find(".adress-wrapper:last select").chosen({disable_search_threshold:30})}}(this))),this.education=$(".education"),this.education_count=0,this.education.length>0&&(this.education_count++,this.education_source=$("#education-template").html(),this.education_source=Handlebars.compile(this.education_source),this.education.prepend(this.education_source({id:this.education_count})),this.add_education=$(".add-education"),this.add_education.on("click",function(e){return function(t){return t.preventDefault(),e.education_count++,e.add_education.before(e.education_source({id:e.education_count}))}}(this))),d=$("select"),d.length>0&&d.chosen({disable_search_threshold:30}),u=$("#duration"),u.length>0&&(u.noUiSlider({step:5,connect:"lower",start:0,range:{min:[30],max:[180]},format:wNumb({decimals:0})}),e=$("#duration-value"),u.Link("lower").to(e),u.on("change",function(){return function(e,t){return console.log(e.currentTarget,t),$("strong.min-time").text(t)}}(this))),t=$("#experience"),t.length>0&&(t.noUiSlider({step:1,connect:"lower",start:0,range:{min:[0],max:[50]},format:wNumb({decimals:0})}),t.Link("lower").to($("#experience-value"))),this.form.h5Validate(),this.form.on("submit",this.afterCheck),this.mounth_widget=this.form.find(".month.dropdown-widget"),this.month=this.mounth_widget.find("select"),this.year_widget=this.form.find(".year.dropdown-widget"),this.year=this.year_widget.find("select"),this.day=this.form.find("input.day"),this.day.on("change",this.checkDate),this.month.on("change",this.checkDate),this.year.on("change",this.checkDate),n=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("city"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"https://dl.dropboxusercontent.com/u/20810772/citys.json"}),n.initialize(),$("#city").typeahead({hint:!0,highlight:!0,minLength:1},{name:"locations",displayKey:"city",source:n.ttAdapter(),templates:{suggestion:Handlebars.compile("<p><b>{{region}}</b>{{city}}</p>")}}),h=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[{title:"Andorra"},{title:"UnitedArabEmirates"},{title:"Afghanistan"},{title:"AntiguaandBarbuda"},{title:"Anguilla"},{title:"Albania"},{title:"Armenia"},{title:"Angola"},{title:"Antarctica"}]}),h.initialize(),$("#univercity").typeahead({hint:!0,highlight:!0,minLength:1},{name:"univercitys",displayKey:"title",source:h.ttAdapter(),templates:{suggestion:Handlebars.compile("<p>{{title}}</p>")}})}return e.prototype.checkDate=function(){var e,t;return e=parseInt(this.day.val().trim(),10),1>e||isNaN(e)?void this.day.val(1):this.mounth_widget.hasClass("unchanged")||this.year_widget.hasClass("unchanged")?e>31?this.day.val(31):void 0:(t=parseInt(moment(this.year.val()+"-"+(parseInt(this.month.val(),10)+1),"YYYY-MM").daysInMonth(),10),void(e>t&&this.day.val(t)))},e.prototype.droped=function(e){return e.preventDefault(),FileAPI.getDropFiles(e,function(){})},e.prototype.over=function(){},e.prototype.drop=function(e){var t;return e.length?(t=new FileReader,t.onload=function(e){return function(t){var i,r;return e.avatarTemplate.content.querySelector("img").src=t.target.result,i=document.importNode(e.avatarTemplate.content,!0),r=e.fileSelector.prev(),r.hasClass("current-avatar")&&r.remove(),e.fileSelector.before(i),e.fileSelector.prev().find(".close").on("click",e.removeAvatar)}}(this),t.readAsDataURL(e[0])):void 0},e.prototype.removeAvatar=function(e){return e.preventDefault(),this.fileSelector.prev().remove(),this.file.replaceWith(this.file.val("").clone(!0)),this.file=this.form.find("#registration-avatar")},e.prototype.avatarSelected=function(e){var t,i,r;return i=FileAPI.getFiles(e),t=i[0].name.substring(i[0].name.lastIndexOf(".")+1).toLowerCase(),i[0]&&i[0].size<=FileAPI.MB&&("gif"===t||"png"===t||"jpeg"===t||"jpg"===t)?(r=new FileReader,r.onload=function(e){return function(t){var i,r;return e.avatarTemplate.content.querySelector("img").src=t.target.result,i=document.importNode(e.avatarTemplate.content,!0),r=e.fileSelector.prev(),r.hasClass("current-avatar")&&r.remove(),e.fileSelector.before(i),e.fileSelector.prev().find(".close").on("click",e.removeAvatar)}}(this),r.readAsDataURL(i[0])):(this.fileSelector.prev().remove(),this.file.replaceWith(this.file.val("").clone(!0)),this.file=this.form.find("#registration-avatar"))},e.prototype.afterCheck=function(e){var t,i,r,a,n;if(this.form.find("input.ui-state-error, select.ui-state-error, textarea.ui-state-error").length>0)return!1;for(t=!1,n=this.form.find(".dropdown-widget"),r=0,a=n.length;a>r;r++)i=n[r],i.controller.validate()||(t=!0);return t?(e.preventDefault(),!1):void 0},e}(),$(document).ready(function(){return new PersonalData});
//# sourceMappingURL=data:application/json;base64,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UGVyc29uYWxEYXRhXG4gIGNvbnN0cnVjdG9yOiAtPlxuICAgIEBmb3JtID0gJCAnZm9ybS5wYW5lbCdcbiAgICBpZiBAZm9ybS5sZW5ndGggIT0gMVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCfQvdC1INC90LDQudC00LXQvdCwINGE0L7RgNC80LAnKVxuXG4gICAgQGZpbGUgPSBAZm9ybS5maW5kICcjcmVnaXN0cmF0aW9uLWF2YXRhcidcbiAgICBAYXZhdGFyVGVtcGxhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCAnY3VycmVudC1hdmF0YXItdGVtcGxhdGUnXG4gICAgQGZpbGVTZWxlY3RvciA9ICQgJy5maWxlLXNlbGVjdG9yJ1xuXG4gICAgIyByZWdhID0gJCgnLnBob3RvJylcbiAgICAjIGlmIHJlZ2EubGVuZ3RoID4gMFxuICAgICMgICByZWdhLmZpbGVhcGlcbiAgICAjICAgICAjIHVybDogQGZvcm0uYXR0cignYWN0aW9uJyksXG4gICAgIyAgICAgdXJsOiAnaHR0cDovL3Rlc3Quc2lsZW50aW1wLmluZm8vdGVzdC5waHAnXG4gICAgIyAgICAgZHVwbGljYXRlOiBmYWxzZVxuICAgICMgICAgIGFjY2VwdDogJ2ltYWdlLyonXG4gICAgIyAgICAgbWF4U2l6ZTogNSAqIEZpbGVBUEkuTUJcbiAgICAjICAgICBhdXRvVXBsb2FkOiBmYWxzZVxuICAgICMgICAgIG11bHRpcGxlOiBmYWxzZVxuICAgICMgICAgIGVsZW1lbnRzOlxuICAgICMgICAgICAgZW1wdHk6IFxuICAgICMgICAgICAgICBzaG93OiAnLmZpbGUtc2VsZWN0b3InXG4gICAgIyAgICAgICBsaXN0OiAnLnByZXZpZXcnXG4gICAgIyAgICAgICBmaWxlOlxuICAgICMgICAgICAgICBwcmV2aWV3OlxuICAgICMgICAgICAgICAgIGVsOiAnLnBob3RvJ1xuICAgICMgICAgICAgICAgIHdpZHRoOiA4MFxuICAgICMgICAgICAgICAgIGhlaWdodDogODBcbiAgICAjICAgICAgICAgdHBsOiAnLmN1cnJlbnQtYXZhdGFyJ1xuICAgICMgICAgICAgZG5kOlxuICAgICMgICAgICAgICBlbDogJy5maWxlLXNlbGVjdG9yJ1xuICAgICMgICAgICAgICBob3ZlcjogJy5maWxlLXNlbGVjdG9yX19maWxlJ1xuICAgICMgICAgICMgb25TZWxlY3Q6IChldnQsIHVpKT0+XG4gICAgIyAgICAgIyAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcbiAgICAjICAgICAjICAgcmVhZGVyLm9ubG9hZCA9IChldmVudCk9PlxuICAgICMgICAgICMgICAgIEBhdmF0YXJUZW1wbGF0ZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJ2ltZycpLnNyYyA9IGV2ZW50LnRhcmdldC5yZXN1bHRcbiAgICAjICAgICAjICAgICBhdmF0YXIgPSBkb2N1bWVudC5pbXBvcnROb2RlIEBhdmF0YXJUZW1wbGF0ZS5jb250ZW50LCB0cnVlXG4gICAgIyAgICAgIyAgICAgcHJldiA9IEBmaWxlU2VsZWN0b3IucHJldigpXG4gICAgIyAgICAgIyAgICAgaWYgcHJldi5oYXNDbGFzcygnY3VycmVudC1hdmF0YXInKVxuICAgICMgICAgICMgICAgICAgcHJldi5yZW1vdmUoKVxuICAgICMgICAgICMgICAgIEBmaWxlU2VsZWN0b3IuYmVmb3JlIGF2YXRhclxuICAgICMgICAgICMgICAgIEBmaWxlU2VsZWN0b3IucHJldigpLmZpbmQoJy5jbG9zZScpLm9uICdjbGljaycsIEByZW1vdmVBdmF0YXJcbiAgICAjICAgICAjICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwgdWkuZmlsZXNbMF1cblxuICAgIEZpbGVBUEkuZXZlbnQub24gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZ2lzdHJhdGlvbi1hdmF0YXInKSwgJ2NoYW5nZScsIEBhdmF0YXJTZWxlY3RlZFxuICAgICQoZG9jdW1lbnQpLmRuZCBAb3ZlciwgQGRyb3BcbiAgICBGaWxlQVBJLmV2ZW50Lm9uIGRvY3VtZW50LCAnZHJvcCcsIEBkcm9wZWRcblxuICAgIHNlcnRpZmljYXRzID0gJCgnLnNlcnRpZmljYXRzJylcbiAgICBpZiBzZXJ0aWZpY2F0cy5sZW5ndGg+MFxuICAgICAgc2VydGlmaWNhdHMuZmlsZWFwaVxuICAgICAgICAjIHVybDogQGZvcm0uYXR0cignYWN0aW9uJyksXG4gICAgICAgIHVybDogJ2h0dHA6Ly90ZXN0LnNpbGVudGltcC5pbmZvL3Rlc3QucGhwJ1xuICAgICAgICBkdXBsaWNhdGU6IGZhbHNlLFxuICAgICAgICBhY2NlcHQ6ICdpbWFnZS8qJyxcbiAgICAgICAgbWF4U2l6ZTogNSAqIEZpbGVBUEkuTUIsXG4gICAgICAgIGF1dG9VcGxvYWQ6IGZhbHNlLFxuICAgICAgICBtdWx0aXBsZTogdHJ1ZSxcbiAgICAgICAgb25TZWxlY3Q6IChldnQsIHVpKT0+XG4gICAgICAgICAgQGNlcmlmaWNhdGVzX2NvdW50KytcbiAgICAgICAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IChldmVudCk9PlxuICAgICAgICAgICAgQGNlcnRfbGlzdC5hcHBlbmQgQHNvdXJjZVxuICAgICAgICAgICAgICBcImlkXCIgOiBAY2VyaWZpY2F0ZXNfY291bnRcbiAgICAgICAgICAgICAgXCJzcmNcIiA6IGV2ZW50LnRhcmdldC5yZXN1bHRcbiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCB1aS5maWxlc1swXVxuICAgICAgICBlbGVtZW50czpcbiAgICAgICAgICBjdHJsOlxuICAgICAgICAgICAgdXBsb2FkOiAnLmFkZC1zZXJ0aWZpY2F0IGxhYmVsJ1xuICAgICAgICAgIGxpc3Q6ICcuc2VydGlmaWNhdC1saXN0J1xuXG5cbiAgICBzZXJ0aWZpY2F0ID0gJChcIiNzZXJ0aWZpY2F0LXRlbXBsYXRlXCIpXG4gICAgaWYgc2VydGlmaWNhdC5sZW5ndGggPjBcbiAgICAgIEBzb3VyY2UgPSAkKFwiI3NlcnRpZmljYXQtdGVtcGxhdGVcIikuaHRtbCgpXG4gICAgICBAc291cmNlID0gSGFuZGxlYmFycy5jb21waWxlIEBzb3VyY2VcbiAgICAgIEBjZXJ0X2xpc3QgPSAkICcuc2VydGlmaWNhdC1saXN0J1xuICAgICAgQGNlcmlmaWNhdGVzX2NvdW50ID0gMFxuXG4gICAgZm9ybWF0ID0gJCAnLmxlc3NvbnMtZm9ybWF0J1xuICAgIGlmIGZvcm1hdC5sZW5ndGggPiAwXG4gICAgICBpbnB1dHMgPSBmb3JtYXQuZmluZCAnaW5wdXQnXG4gICAgICBmb3IgaW5wdXQgaW4gaW5wdXRzXG4gICAgICAgIHByaWNlX2lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQgaW5wdXQuZ2V0QXR0cmlidXRlKCdkYXRhLXByaWNlLWZpZWxkJylcbiAgICAgICAgcHJpY2UgPSAkKHByaWNlX2lucHV0KS5jbG9zZXN0KCcuc3ViZGV2aXNpb24nKVxuICAgICAgICBpZiBpbnB1dC5jaGVja2VkXG4gICAgICAgICAgcHJpY2UucmVtb3ZlQ2xhc3MoJ2hpZGUnKVxuICAgICAgICAgIHByaWNlX2lucHV0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgICAgICAgIHByaWNlX2lucHV0LnNldEF0dHJpYnV0ZSgncmVxdWlyZWQnLCAncmVxdWlyZWQnKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgcHJpY2UuYWRkQ2xhc3MoJ2hpZGUnKVxuICAgICAgICAgIHByaWNlX2lucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ3VpLXN0YXRlLWVycm9yJylcbiAgICAgICAgICBwcmljZV9pbnB1dC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJylcbiAgICAgICAgICBwcmljZV9pbnB1dC5yZW1vdmVBdHRyaWJ1dGUoJ3JlcXVpcmVkJylcblxuICAgICAgaW5wdXRzLm9uICdjaGFuZ2UnLCAoZXZlbnQpPT5cbiAgICAgICAgaW5wdXQgPSAkIGV2ZW50LmN1cnJlbnRUYXJnZXRcbiAgICAgICAgcHJpY2VfaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCBpbnB1dC5hdHRyKCdkYXRhLXByaWNlLWZpZWxkJylcbiAgICAgICAgcHJpY2UgPSAkKHByaWNlX2lucHV0KS5jbG9zZXN0KCcuc3ViZGV2aXNpb24nKVxuICAgICAgICBpZiBldmVudC5jdXJyZW50VGFyZ2V0LmNoZWNrZWRcbiAgICAgICAgICBwcmljZS5yZW1vdmVDbGFzcygnaGlkZScpXG4gICAgICAgICAgcHJpY2VfaW5wdXQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgICAgICAgcHJpY2VfaW5wdXQuc2V0QXR0cmlidXRlKCdyZXF1aXJlZCcsICdyZXF1aXJlZCcpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICBwcmljZS5hZGRDbGFzcygnaGlkZScpXG4gICAgICAgICAgcHJpY2VfaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgndWktc3RhdGUtZXJyb3InKVxuICAgICAgICAgIHByaWNlX2lucHV0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKVxuICAgICAgICAgIHByaWNlX2lucHV0LnJlbW92ZUF0dHJpYnV0ZSgncmVxdWlyZWQnKVxuICAgICAgICAgIFxuXG5cbiAgICBAYWRkcmVzcyA9ICQgJy5hZGRyZXNzLWhvbGRlcidcbiAgICBAYWRkcmVzc19jb3VudCA9IDBcbiAgICBpZiBAYWRkcmVzcy5sZW5ndGggPiAwXG4gICAgICBAYWRkcmVzc19jb3VudCsrXG4gICAgICBAYWRkcmVzc19zb3VyY2UgPSAkKFwiI2FkZHJlc3MtdGVtcGxhdGVcIikuaHRtbCgpXG4gICAgICBAYWRkcmVzc19zb3VyY2UgPSBIYW5kbGViYXJzLmNvbXBpbGUgQGFkZHJlc3Nfc291cmNlXG4gICAgICBAYWRkcmVzcy5wcmVwZW5kIEBhZGRyZXNzX3NvdXJjZVxuICAgICAgICBcImlkXCIgOiBAYWRkcmVzc19jb3VudFxuICAgICAgQGFkZF9lZHVjYXRpb24gPSAkICcuYWRkLWFkZHJlc3MnXG4gICAgICBAYWRkX2VkdWNhdGlvbi5vbiAnY2xpY2snLCAoZXZlbnQpPT5cbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICBAYWRkcmVzc19jb3VudCsrXG4gICAgICAgIEBhZGRfZWR1Y2F0aW9uLmJlZm9yZSBAYWRkcmVzc19zb3VyY2VcbiAgICAgICAgICBcImlkXCIgOiBAYWRkcmVzc19jb3VudFxuICAgICAgICBAYWRkcmVzcy5maW5kKCcuYWRyZXNzLXdyYXBwZXI6bGFzdCBzZWxlY3QnKS5jaG9zZW5cbiAgICAgICAgICBkaXNhYmxlX3NlYXJjaF90aHJlc2hvbGQ6IDMwXG5cbiAgICBAZWR1Y2F0aW9uID0gJCAnLmVkdWNhdGlvbidcbiAgICBAZWR1Y2F0aW9uX2NvdW50ID0gMFxuICAgIGlmIEBlZHVjYXRpb24ubGVuZ3RoID4gMFxuICAgICAgQGVkdWNhdGlvbl9jb3VudCsrXG4gICAgICBAZWR1Y2F0aW9uX3NvdXJjZSA9ICQoXCIjZWR1Y2F0aW9uLXRlbXBsYXRlXCIpLmh0bWwoKVxuICAgICAgQGVkdWNhdGlvbl9zb3VyY2UgPSBIYW5kbGViYXJzLmNvbXBpbGUgQGVkdWNhdGlvbl9zb3VyY2VcbiAgICAgIEBlZHVjYXRpb24ucHJlcGVuZCBAZWR1Y2F0aW9uX3NvdXJjZVxuICAgICAgICBcImlkXCIgOiBAZWR1Y2F0aW9uX2NvdW50XG4gICAgICBAYWRkX2VkdWNhdGlvbiA9ICQgJy5hZGQtZWR1Y2F0aW9uJ1xuICAgICAgQGFkZF9lZHVjYXRpb24ub24gJ2NsaWNrJywgKGV2ZW50KT0+XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgQGVkdWNhdGlvbl9jb3VudCsrXG4gICAgICAgIEBhZGRfZWR1Y2F0aW9uLmJlZm9yZSBAZWR1Y2F0aW9uX3NvdXJjZVxuICAgICAgICAgIFwiaWRcIiA6IEBlZHVjYXRpb25fY291bnRcblxuICAgIHNlbGVjdCA9ICQgJ3NlbGVjdCdcbiAgICBpZiBzZWxlY3QubGVuZ3RoID4gMFxuICAgICAgc2VsZWN0LmNob3NlblxuICAgICAgICBkaXNhYmxlX3NlYXJjaF90aHJlc2hvbGQ6IDMwXG5cbiAgICB0aW1lID0gJCAnI2R1cmF0aW9uJ1xuICAgIGlmIHRpbWUubGVuZ3RoID4gMFxuICAgICAgdGltZS5ub1VpU2xpZGVyXG4gICAgICAgIHN0ZXA6IDUsXG4gICAgICAgIGNvbm5lY3Q6IFwibG93ZXJcIixcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIHJhbmdlOlxuICAgICAgICAgICdtaW4nOiBbMzBdLFxuICAgICAgICAgICdtYXgnOiBbMTgwXVxuICAgICAgICBmb3JtYXQ6IHdOdW1iXG4gICAgICAgICAgZGVjaW1hbHM6IDBcblxuICAgICAgZHVyYXRpb24gPSAkKCcjZHVyYXRpb24tdmFsdWUnKVxuICAgICAgdGltZS5MaW5rKCdsb3dlcicpLnRvKGR1cmF0aW9uKVxuICAgICAgdGltZS5vbiAnY2hhbmdlJywgKGV2ZW50LCB1aSk9PlxuICAgICAgICBjb25zb2xlLmxvZyBldmVudC5jdXJyZW50VGFyZ2V0LCB1aVxuICAgICAgICAkKCdzdHJvbmcubWluLXRpbWUnKS50ZXh0KHVpKVxuXG4gICAgZXhwID0gJCAnI2V4cGVyaWVuY2UnXG4gICAgaWYgZXhwLmxlbmd0aCA+IDBcbiAgICAgIGV4cC5ub1VpU2xpZGVyXG4gICAgICAgIHN0ZXA6IDEsXG4gICAgICAgIGNvbm5lY3Q6IFwibG93ZXJcIixcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIHJhbmdlOlxuICAgICAgICAgICdtaW4nOiBbMF0sXG4gICAgICAgICAgJ21heCc6IFs1MF1cbiAgICAgICAgZm9ybWF0OiB3TnVtYlxuICAgICAgICAgIGRlY2ltYWxzOiAwXG4gICAgICBleHAuTGluaygnbG93ZXInKS50bygkKCcjZXhwZXJpZW5jZS12YWx1ZScpKVxuXG4gICAgQGZvcm0uaDVWYWxpZGF0ZSgpXG4gICAgQGZvcm0ub24gJ3N1Ym1pdCcsIEBhZnRlckNoZWNrXG5cbiAgICBAbW91bnRoX3dpZGdldCA9IEBmb3JtLmZpbmQgJy5tb250aC5kcm9wZG93bi13aWRnZXQnXG4gICAgQG1vbnRoID0gIEBtb3VudGhfd2lkZ2V0LmZpbmQgJ3NlbGVjdCdcbiAgICBAeWVhcl93aWRnZXQgPSBAZm9ybS5maW5kICcueWVhci5kcm9wZG93bi13aWRnZXQnXG4gICAgQHllYXIgPSAgQHllYXJfd2lkZ2V0LmZpbmQgJ3NlbGVjdCdcbiAgICBAZGF5ID0gQGZvcm0uZmluZCAnaW5wdXQuZGF5J1xuICAgIFxuICAgIEBkYXkub24gICAnY2hhbmdlJywgQGNoZWNrRGF0ZVxuICAgIEBtb250aC5vbiAnY2hhbmdlJywgQGNoZWNrRGF0ZVxuICAgIEB5ZWFyLm9uICAnY2hhbmdlJywgQGNoZWNrRGF0ZVxuXG4gICAgbG9jYXRpb25zID0gbmV3IEJsb29kaG91bmRcbiAgICAgIGRhdHVtVG9rZW5pemVyOiBCbG9vZGhvdW5kLnRva2VuaXplcnMub2JqLndoaXRlc3BhY2UoXCJjaXR5XCIpLFxuICAgICAgcXVlcnlUb2tlbml6ZXI6IEJsb29kaG91bmQudG9rZW5pemVycy53aGl0ZXNwYWNlLFxuICAgICAgcHJlZmV0Y2g6IFwiaHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3UvMjA4MTA3NzIvY2l0eXMuanNvblwiXG4gICAgXG4gICAgbG9jYXRpb25zLmluaXRpYWxpemUoKVxuXG4gICAgJCgnI2NpdHknKS50eXBlYWhlYWRcbiAgICAgIGhpbnQ6IHRydWVcbiAgICAgIGhpZ2hsaWdodDogdHJ1ZVxuICAgICAgbWluTGVuZ3RoOiAxXG4gICAgLFxuICAgICAgbmFtZTogJ2xvY2F0aW9ucydcbiAgICAgIGRpc3BsYXlLZXk6ICdjaXR5JyxcbiAgICAgIHNvdXJjZTogbG9jYXRpb25zLnR0QWRhcHRlcigpXG4gICAgICB0ZW1wbGF0ZXM6XG4gICAgICAgIHN1Z2dlc3Rpb246IEhhbmRsZWJhcnMuY29tcGlsZSgnPHA+PGI+e3tyZWdpb259fTwvYj57e2NpdHl9fTwvcD4nKVxuXG4gICAgdW5pdmVyY2l0eXMgPSBuZXcgQmxvb2Rob3VuZFxuICAgICAgZGF0dW1Ub2tlbml6ZXI6IChkYXRhKS0+XG4gICAgICAgIHJldHVybiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZShkYXRhLnRpdGxlKVxuICAgICAgcXVlcnlUb2tlbml6ZXI6IEJsb29kaG91bmQudG9rZW5pemVycy53aGl0ZXNwYWNlLFxuICAgICAgbG9jYWw6IFt7XCJ0aXRsZVwiOlwiQW5kb3JyYVwifSx7XCJ0aXRsZVwiOlwiVW5pdGVkQXJhYkVtaXJhdGVzXCJ9LHtcInRpdGxlXCI6XCJBZmdoYW5pc3RhblwifSx7XCJ0aXRsZVwiOlwiQW50aWd1YWFuZEJhcmJ1ZGFcIn0se1widGl0bGVcIjpcIkFuZ3VpbGxhXCJ9LHtcInRpdGxlXCI6XCJBbGJhbmlhXCJ9LHtcInRpdGxlXCI6XCJBcm1lbmlhXCJ9LHtcInRpdGxlXCI6XCJBbmdvbGFcIn0se1widGl0bGVcIjpcIkFudGFyY3RpY2FcIn1dXG5cbiAgICB1bml2ZXJjaXR5cy5pbml0aWFsaXplKClcblxuICAgICQoJyN1bml2ZXJjaXR5JykudHlwZWFoZWFkXG4gICAgICBoaW50OiB0cnVlXG4gICAgICBoaWdobGlnaHQ6IHRydWVcbiAgICAgIG1pbkxlbmd0aDogMVxuICAgICxcbiAgICAgIG5hbWU6ICd1bml2ZXJjaXR5cydcbiAgICAgIGRpc3BsYXlLZXk6ICd0aXRsZScsXG4gICAgICBzb3VyY2U6IHVuaXZlcmNpdHlzLnR0QWRhcHRlcigpXG4gICAgICB0ZW1wbGF0ZXM6XG4gICAgICAgIHN1Z2dlc3Rpb246IEhhbmRsZWJhcnMuY29tcGlsZSgnPHA+e3t0aXRsZX19PC9wPicpXG5cblxuICBjaGVja0RhdGU6IChldmVudCk9PlxuICAgIGRheSA9IHBhcnNlSW50IEBkYXkudmFsKCkudHJpbSgpLCAxMFxuXG4gICAgaWYgZGF5PDEgfHwgaXNOYU4oZGF5KVxuICAgICAgQGRheS52YWwgMVxuICAgICAgcmV0dXJuXG5cbiAgICBpZiAhQG1vdW50aF93aWRnZXQuaGFzQ2xhc3MoJ3VuY2hhbmdlZCcpICYmICFAeWVhcl93aWRnZXQuaGFzQ2xhc3MoJ3VuY2hhbmdlZCcpXG5cbiAgICAgIGRheXMgPSBwYXJzZUludCBtb21lbnQoQHllYXIudmFsKCkrXCItXCIrKHBhcnNlSW50KEBtb250aC52YWwoKSwxMCkrMSksIFwiWVlZWS1NTVwiKS5kYXlzSW5Nb250aCgpLCAxMFxuICAgICAgaWYgZGF5PmRheXNcbiAgICAgICAgQGRheS52YWwgZGF5c1xuICAgICAgICBcbiAgICAgIHJldHVyblxuXG4gICAgaWYgZGF5PjMxXG4gICAgICBAZGF5LnZhbCAzMVxuXG4gIGRyb3BlZDogKGV2ZW50KS0+XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgIEZpbGVBUEkuZ2V0RHJvcEZpbGVzIGV2ZW50LCAoZmlsZXMpLT5cblxuICBvdmVyOiAob3ZlciktPlxuXG5cbiAgZHJvcDogKGZpbGVzKT0+XG4gICAgaWYgZmlsZXMubGVuZ3RoXG4gICAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gICAgICBcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpPT5cbiAgICAgICAgQGF2YXRhclRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignaW1nJykuc3JjID0gZXZlbnQudGFyZ2V0LnJlc3VsdFxuICAgICAgICBhdmF0YXIgPSBkb2N1bWVudC5pbXBvcnROb2RlIEBhdmF0YXJUZW1wbGF0ZS5jb250ZW50LCB0cnVlXG4gICAgICAgIHByZXYgPSBAZmlsZVNlbGVjdG9yLnByZXYoKVxuICAgICAgICBpZiBwcmV2Lmhhc0NsYXNzKCdjdXJyZW50LWF2YXRhcicpXG4gICAgICAgICAgcHJldi5yZW1vdmUoKVxuICAgICAgICBAZmlsZVNlbGVjdG9yLmJlZm9yZSBhdmF0YXJcbiAgICAgICAgQGZpbGVTZWxlY3Rvci5wcmV2KCkuZmluZCgnLmNsb3NlJykub24gJ2NsaWNrJywgQHJlbW92ZUF2YXRhclxuICAgICAgXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCBmaWxlc1swXVxuXG4gIHJlbW92ZUF2YXRhcjogKGV2ZW50KT0+XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgIEBmaWxlU2VsZWN0b3IucHJldigpLnJlbW92ZSgpXG4gICAgQGZpbGUucmVwbGFjZVdpdGggQGZpbGUudmFsKCcnKS5jbG9uZSh0cnVlKVxuICAgIEBmaWxlID0gQGZvcm0uZmluZCAnI3JlZ2lzdHJhdGlvbi1hdmF0YXInXG5cbiAgYXZhdGFyU2VsZWN0ZWQ6IChldmVudCk9PlxuICAgIGZpbGVzID0gRmlsZUFQSS5nZXRGaWxlcyhldmVudClcblxuICAgIGV4dCA9IGZpbGVzWzBdWyduYW1lJ10uc3Vic3RyaW5nKGZpbGVzWzBdWyduYW1lJ10ubGFzdEluZGV4T2YoJy4nKSArIDEpLnRvTG93ZXJDYXNlKClcblxuICAgIGlmIChmaWxlc1swXSAmJiAoZmlsZXNbMF0uc2l6ZSA8PSBGaWxlQVBJLk1CKSAmJiAoZXh0ID09IFwiZ2lmXCIgfHwgZXh0ID09IFwicG5nXCIgfHwgZXh0ID09IFwianBlZ1wiIHx8IGV4dCA9PSBcImpwZ1wiKSlcbiAgICAgICAgXG4gICAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gICAgICByZWFkZXIub25sb2FkID0gKGV2ZW50KT0+XG4gICAgICAgIFxuICAgICAgICBAYXZhdGFyVGVtcGxhdGUuY29udGVudC5xdWVyeVNlbGVjdG9yKCdpbWcnKS5zcmMgPSBldmVudC50YXJnZXQucmVzdWx0XG4gICAgICAgIGF2YXRhciA9IGRvY3VtZW50LmltcG9ydE5vZGUgQGF2YXRhclRlbXBsYXRlLmNvbnRlbnQsIHRydWVcbiAgICAgICAgcHJldiA9IEBmaWxlU2VsZWN0b3IucHJldigpXG4gICAgICAgIGlmIHByZXYuaGFzQ2xhc3MoJ2N1cnJlbnQtYXZhdGFyJylcbiAgICAgICAgICBwcmV2LnJlbW92ZSgpXG4gICAgICAgIEBmaWxlU2VsZWN0b3IuYmVmb3JlIGF2YXRhclxuICAgICAgICBAZmlsZVNlbGVjdG9yLnByZXYoKS5maW5kKCcuY2xvc2UnKS5vbiAnY2xpY2snLCBAcmVtb3ZlQXZhdGFyXG5cbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMIGZpbGVzWzBdXG5cbiAgICBlbHNlXG4gICAgICBAZmlsZVNlbGVjdG9yLnByZXYoKS5yZW1vdmUoKVxuICAgICAgQGZpbGUucmVwbGFjZVdpdGggQGZpbGUudmFsKCcnKS5jbG9uZSh0cnVlKVxuICAgICAgQGZpbGUgPSBAZm9ybS5maW5kICcjcmVnaXN0cmF0aW9uLWF2YXRhcidcblxuXG4gIGFmdGVyQ2hlY2s6IChldmVudCk9PlxuICAgIFxuICAgIGlmIEBmb3JtLmZpbmQoJ2lucHV0LnVpLXN0YXRlLWVycm9yLCBzZWxlY3QudWktc3RhdGUtZXJyb3IsIHRleHRhcmVhLnVpLXN0YXRlLWVycm9yJykubGVuZ3RoID4gMFxuICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICBkcm9wX2Rvd25fZXJyID0gZmFsc2VcblxuICAgIGZvciBpbnB1dCBpbiBAZm9ybS5maW5kKCcuZHJvcGRvd24td2lkZ2V0JylcbiAgICAgIGlmICFpbnB1dC5jb250cm9sbGVyLnZhbGlkYXRlKClcbiAgICAgICAgZHJvcF9kb3duX2VyciA9IHRydWVcblxuICAgIGlmIGRyb3BfZG93bl9lcnJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgIHJldHVybiBmYWxzZVxuXG5cbiQoZG9jdW1lbnQpLnJlYWR5IC0+XG4gIG5ldyBQZXJzb25hbERhdGEoKSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==