var PersonalData,__bind=function(e,t){return function(){return e.apply(t,arguments)}};PersonalData=function(){function e(){this.afterCheck=__bind(this.afterCheck,this),this.avatarSelected=__bind(this.avatarSelected,this),this.removeAvatar=__bind(this.removeAvatar,this),this.drop=__bind(this.drop,this),this.checkDate=__bind(this.checkDate,this);var e,t,i,r,a;if(this.form=$("form.panel"),1!==this.form.length)throw new Error("не найдена форма");this.file=this.form.find("#registration-avatar"),this.avatarTemplate=document.getElementById("current-avatar-template"),this.fileSelector=$(".file-selector"),FileAPI.event.on(document.getElementById("registration-avatar"),"change",this.avatarSelected),$(document).dnd(this.over,this.drop),this.source=$("#sertificat-template").html(),this.source=Handlebars.compile(this.source),this.cert_list=$(".sertificat-list"),this.cerificates_count=0,FileAPI.event.on(document,"drop",this.droped),i=$("select"),i.length>0&&i.chosen({disable_search_threshold:30}),e=$("#experience"),e.length>0&&(e.noUiSlider({step:1,connect:"lower",start:0,range:{min:[0],max:[50]},format:wNumb({decimals:0})}),e.Link("lower").to($("#experience-value"))),r=$(".sertificats"),r.length>0&&$(".sertificats").fileapi({url:"http://test.silentimp.info/test.php",duplicate:!1,accept:"image/*",maxSize:5*FileAPI.MB,autoUpload:!1,multiple:!0,onSelect:function(e){return function(t,i){var r;return console.log(t),console.log(i),e.cerificates_count++,r=new FileReader,r.onload=function(t){return e.cert_list.append(e.source({id:e.cerificates_count,src:t.target.result}))},r.readAsDataURL(i.files[0])}}(this),elements:{ctrl:{upload:".add-sertificat label"},list:".sertificat-list"}}),this.form.h5Validate(),this.form.on("submit",this.afterCheck),this.mounth_widget=this.form.find(".month.dropdown-widget"),this.month=this.mounth_widget.find("select"),this.year_widget=this.form.find(".year.dropdown-widget"),this.year=this.year_widget.find("select"),this.day=this.form.find("input.day"),this.day.on("change",this.checkDate),this.month.on("change",this.checkDate),this.year.on("change",this.checkDate),t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("city"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"https://dl.dropboxusercontent.com/u/20810772/citys.json"}),t.initialize(),$("#city").typeahead({hint:!0,highlight:!0,minLength:1},{name:"locations",displayKey:"city",source:t.ttAdapter(),templates:{suggestion:Handlebars.compile("<p><b>{{region}}</b>{{city}}</p>")}}),a=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[{title:"Andorra"},{title:"UnitedArabEmirates"},{title:"Afghanistan"},{title:"AntiguaandBarbuda"},{title:"Anguilla"},{title:"Albania"},{title:"Armenia"},{title:"Angola"},{title:"Antarctica"}]}),a.initialize(),$("#univercity").typeahead({hint:!0,highlight:!0,minLength:1},{name:"univercitys",displayKey:"title",source:a.ttAdapter(),templates:{suggestion:Handlebars.compile("<p>{{title}}</p>")}})}return e.prototype.checkDate=function(){var e,t;return e=parseInt(this.day.val().trim(),10),1>e||isNaN(e)?void this.day.val(1):this.mounth_widget.hasClass("unchanged")||this.year_widget.hasClass("unchanged")?e>31?this.day.val(31):void 0:(t=parseInt(moment(this.year.val()+"-"+(parseInt(this.month.val(),10)+1),"YYYY-MM").daysInMonth(),10),void(e>t&&this.day.val(t)))},e.prototype.droped=function(e){return e.preventDefault(),FileAPI.getDropFiles(e,function(){})},e.prototype.over=function(){},e.prototype.drop=function(e){var t;return e.length?(t=new FileReader,t.onload=function(e){return function(t){var i,r;return e.avatarTemplate.content.querySelector("img").src=t.target.result,i=document.importNode(e.avatarTemplate.content,!0),r=e.fileSelector.prev(),r.hasClass("current-avatar")&&r.remove(),e.fileSelector.before(i),e.fileSelector.prev().find(".close").on("click",e.removeAvatar)}}(this),t.readAsDataURL(e[0])):void 0},e.prototype.removeAvatar=function(e){return e.preventDefault(),this.fileSelector.prev().remove(),this.file.replaceWith(this.file.val("").clone(!0)),this.file=this.form.find("#registration-avatar")},e.prototype.avatarSelected=function(e){var t,i,r;return i=FileAPI.getFiles(e),t=i[0].name.substring(i[0].name.lastIndexOf(".")+1).toLowerCase(),!i[0]||"gif"!==t&&"png"!==t&&"jpeg"!==t&&"jpg"!==t?void 0:(r=new FileReader,r.onload=function(e){return function(t){var i,r;return e.avatarTemplate.content.querySelector("img").src=t.target.result,i=document.importNode(e.avatarTemplate.content,!0),r=e.fileSelector.prev(),r.hasClass("current-avatar")&&r.remove(),e.fileSelector.before(i),e.fileSelector.prev().find(".close").on("click",e.removeAvatar)}}(this),r.readAsDataURL(i[0]))},e.prototype.afterCheck=function(e){var t,i,r,a,n;if(this.form.find("input.ui-state-error, select.ui-state-error, textarea.ui-state-error").length>0)return!1;for(t=!1,n=this.form.find(".dropdown-widget"),r=0,a=n.length;a>r;r++)i=n[r],i.controller.validate()||(t=!0);return t?(e.preventDefault(),!1):void 0},e}(),$(document).ready(function(){return new PersonalData});
//# sourceMappingURL=data:application/json;base64,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QUFBLFdBQ0ssRUFBTyxXQUFXLGFBQ25CLEdBQWdCLEVBRXBCLE9BQUcsSUFDRCxFQUFNLGtCQUNDLEdBRlQsYUFsTUosRUF1TUUsVUFBVSxNQUFNLGlCQUNaLElBQUEiLCJmaWxlIjoiUGVyc29uYWxEYXRhLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgUGVyc29uYWxEYXRhXG4gIGNvbnN0cnVjdG9yOiAtPlxuICAgIEBmb3JtID0gJCAnZm9ybS5wYW5lbCdcbiAgICBpZiBAZm9ybS5sZW5ndGggIT0gMVxuICAgICAgdGhyb3cgbmV3IEVycm9yKCfQvdC1INC90LDQudC00LXQvdCwINGE0L7RgNC80LAnKVxuXG4gICAgQGZpbGUgPSBAZm9ybS5maW5kICcjcmVnaXN0cmF0aW9uLWF2YXRhcidcbiAgICBAYXZhdGFyVGVtcGxhdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCAnY3VycmVudC1hdmF0YXItdGVtcGxhdGUnXG4gICAgQGZpbGVTZWxlY3RvciA9ICQgJy5maWxlLXNlbGVjdG9yJ1xuXG4gICAgRmlsZUFQSS5ldmVudC5vbiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVnaXN0cmF0aW9uLWF2YXRhcicpLCAnY2hhbmdlJywgQGF2YXRhclNlbGVjdGVkXG4gICAgJChkb2N1bWVudCkuZG5kIEBvdmVyLCBAZHJvcFxuXG4gICAgQHNvdXJjZSA9ICQoXCIjc2VydGlmaWNhdC10ZW1wbGF0ZVwiKS5odG1sKClcbiAgICBAc291cmNlID0gSGFuZGxlYmFycy5jb21waWxlIEBzb3VyY2VcbiAgICBAY2VydF9saXN0ID0gJCAnLnNlcnRpZmljYXQtbGlzdCdcbiAgICBAY2VyaWZpY2F0ZXNfY291bnQgPSAwXG5cbiAgICBGaWxlQVBJLmV2ZW50Lm9uIGRvY3VtZW50LCAnZHJvcCcsIEBkcm9wZWRcblxuICAgIHNlbGVjdCA9ICQoJ3NlbGVjdCcpXG4gICAgaWYgc2VsZWN0Lmxlbmd0aCA+IDBcbiAgICAgIHNlbGVjdC5jaG9zZW5cbiAgICAgICAgZGlzYWJsZV9zZWFyY2hfdGhyZXNob2xkOiAzMFxuXG4gICAgZXhwID0gJCAnI2V4cGVyaWVuY2UnXG4gICAgaWYgZXhwLmxlbmd0aCA+IDBcbiAgICAgIGV4cC5ub1VpU2xpZGVyXG4gICAgICAgIHN0ZXA6IDEsXG4gICAgICAgIGNvbm5lY3Q6IFwibG93ZXJcIixcbiAgICAgICAgc3RhcnQ6IDAsXG4gICAgICAgIHJhbmdlOlxuICAgICAgICAgICdtaW4nOiBbMF0sXG4gICAgICAgICAgJ21heCc6IFs1MF1cbiAgICAgICAgZm9ybWF0OiB3TnVtYlxuICAgICAgICAgIGRlY2ltYWxzOiAwXG4gICAgICBleHAuTGluaygnbG93ZXInKS50bygkKCcjZXhwZXJpZW5jZS12YWx1ZScpKVxuXG4gICAgc2VydGlmaWNhdHMgPSAkKCcuc2VydGlmaWNhdHMnKVxuICAgIGlmIHNlcnRpZmljYXRzLmxlbmd0aD4wXG4gICAgICAkKCcuc2VydGlmaWNhdHMnKS5maWxlYXBpXG4gICAgICAgICMgdXJsOiBAZm9ybS5hdHRyKCdhY3Rpb24nKSxcbiAgICAgICAgdXJsOiAnaHR0cDovL3Rlc3Quc2lsZW50aW1wLmluZm8vdGVzdC5waHAnXG4gICAgICAgIGR1cGxpY2F0ZTogZmFsc2UsXG4gICAgICAgIGFjY2VwdDogJ2ltYWdlLyonLFxuICAgICAgICBtYXhTaXplOiA1ICogRmlsZUFQSS5NQixcbiAgICAgICAgYXV0b1VwbG9hZDogZmFsc2UsXG4gICAgICAgIG11bHRpcGxlOiB0cnVlLFxuICAgICAgICBvblNlbGVjdDogKGV2dCwgdWkpPT5cbiAgICAgICAgICBjb25zb2xlLmxvZyBldnRcbiAgICAgICAgICBjb25zb2xlLmxvZyB1aVxuICAgICAgICAgIEBjZXJpZmljYXRlc19jb3VudCsrXG4gICAgICAgICAgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpPT5cblxuICAgICAgICAgICAgQGNlcnRfbGlzdC5hcHBlbmQgQHNvdXJjZVxuICAgICAgICAgICAgICBcImlkXCIgOiBAY2VyaWZpY2F0ZXNfY291bnRcbiAgICAgICAgICAgICAgXCJzcmNcIiA6IGV2ZW50LnRhcmdldC5yZXN1bHRcbiAgICAgICAgICAgIFxuICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMIHVpLmZpbGVzWzBdXG5cbiAgICAgICAgZWxlbWVudHM6XG4gICAgICAgICAgY3RybDpcbiAgICAgICAgICAgIHVwbG9hZDogJy5hZGQtc2VydGlmaWNhdCBsYWJlbCdcbiAgICAgICAgICBsaXN0OiAnLnNlcnRpZmljYXQtbGlzdCdcblxuICAgIEBmb3JtLmg1VmFsaWRhdGUoKVxuICAgIEBmb3JtLm9uICdzdWJtaXQnLCBAYWZ0ZXJDaGVja1xuXG4gICAgQG1vdW50aF93aWRnZXQgPSBAZm9ybS5maW5kICcubW9udGguZHJvcGRvd24td2lkZ2V0J1xuICAgIEBtb250aCA9ICBAbW91bnRoX3dpZGdldC5maW5kICdzZWxlY3QnXG4gICAgQHllYXJfd2lkZ2V0ID0gQGZvcm0uZmluZCAnLnllYXIuZHJvcGRvd24td2lkZ2V0J1xuICAgIEB5ZWFyID0gIEB5ZWFyX3dpZGdldC5maW5kICdzZWxlY3QnXG4gICAgQGRheSA9IEBmb3JtLmZpbmQgJ2lucHV0LmRheSdcbiAgICBcbiAgICBAZGF5Lm9uICAgJ2NoYW5nZScsIEBjaGVja0RhdGVcbiAgICBAbW9udGgub24gJ2NoYW5nZScsIEBjaGVja0RhdGVcbiAgICBAeWVhci5vbiAgJ2NoYW5nZScsIEBjaGVja0RhdGVcblxuICAgIGxvY2F0aW9ucyA9IG5ldyBCbG9vZGhvdW5kXG4gICAgICBkYXR1bVRva2VuaXplcjogQmxvb2Rob3VuZC50b2tlbml6ZXJzLm9iai53aGl0ZXNwYWNlKFwiY2l0eVwiKSxcbiAgICAgIHF1ZXJ5VG9rZW5pemVyOiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZSxcbiAgICAgIHByZWZldGNoOiBcImh0dHBzOi8vZGwuZHJvcGJveHVzZXJjb250ZW50LmNvbS91LzIwODEwNzcyL2NpdHlzLmpzb25cIlxuICAgIFxuICAgIGxvY2F0aW9ucy5pbml0aWFsaXplKClcblxuICAgICQoJyNjaXR5JykudHlwZWFoZWFkXG4gICAgICBoaW50OiB0cnVlXG4gICAgICBoaWdobGlnaHQ6IHRydWVcbiAgICAgIG1pbkxlbmd0aDogMVxuICAgICxcbiAgICAgIG5hbWU6ICdsb2NhdGlvbnMnXG4gICAgICBkaXNwbGF5S2V5OiAnY2l0eScsXG4gICAgICBzb3VyY2U6IGxvY2F0aW9ucy50dEFkYXB0ZXIoKVxuICAgICAgdGVtcGxhdGVzOlxuICAgICAgICBzdWdnZXN0aW9uOiBIYW5kbGViYXJzLmNvbXBpbGUoJzxwPjxiPnt7cmVnaW9ufX08L2I+e3tjaXR5fX08L3A+JylcblxuICAgIHVuaXZlcmNpdHlzID0gbmV3IEJsb29kaG91bmRcbiAgICAgIGRhdHVtVG9rZW5pemVyOiAoZGF0YSktPlxuICAgICAgICByZXR1cm4gQmxvb2Rob3VuZC50b2tlbml6ZXJzLndoaXRlc3BhY2UoZGF0YS50aXRsZSlcbiAgICAgIHF1ZXJ5VG9rZW5pemVyOiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZSxcbiAgICAgIGxvY2FsOiBbe1widGl0bGVcIjpcIkFuZG9ycmFcIn0se1widGl0bGVcIjpcIlVuaXRlZEFyYWJFbWlyYXRlc1wifSx7XCJ0aXRsZVwiOlwiQWZnaGFuaXN0YW5cIn0se1widGl0bGVcIjpcIkFudGlndWFhbmRCYXJidWRhXCJ9LHtcInRpdGxlXCI6XCJBbmd1aWxsYVwifSx7XCJ0aXRsZVwiOlwiQWxiYW5pYVwifSx7XCJ0aXRsZVwiOlwiQXJtZW5pYVwifSx7XCJ0aXRsZVwiOlwiQW5nb2xhXCJ9LHtcInRpdGxlXCI6XCJBbnRhcmN0aWNhXCJ9XVxuXG4gICAgdW5pdmVyY2l0eXMuaW5pdGlhbGl6ZSgpXG5cbiAgICAkKCcjdW5pdmVyY2l0eScpLnR5cGVhaGVhZFxuICAgICAgaGludDogdHJ1ZVxuICAgICAgaGlnaGxpZ2h0OiB0cnVlXG4gICAgICBtaW5MZW5ndGg6IDFcbiAgICAsXG4gICAgICBuYW1lOiAndW5pdmVyY2l0eXMnXG4gICAgICBkaXNwbGF5S2V5OiAndGl0bGUnLFxuICAgICAgc291cmNlOiB1bml2ZXJjaXR5cy50dEFkYXB0ZXIoKVxuICAgICAgdGVtcGxhdGVzOlxuICAgICAgICBzdWdnZXN0aW9uOiBIYW5kbGViYXJzLmNvbXBpbGUoJzxwPnt7dGl0bGV9fTwvcD4nKVxuXG5cbiAgY2hlY2tEYXRlOiAoZXZlbnQpPT5cbiAgICBkYXkgPSBwYXJzZUludCBAZGF5LnZhbCgpLnRyaW0oKSwgMTBcblxuICAgIGlmIGRheTwxIHx8IGlzTmFOKGRheSlcbiAgICAgIEBkYXkudmFsIDFcbiAgICAgIHJldHVyblxuXG4gICAgaWYgIUBtb3VudGhfd2lkZ2V0Lmhhc0NsYXNzKCd1bmNoYW5nZWQnKSAmJiAhQHllYXJfd2lkZ2V0Lmhhc0NsYXNzKCd1bmNoYW5nZWQnKVxuXG4gICAgICBkYXlzID0gcGFyc2VJbnQgbW9tZW50KEB5ZWFyLnZhbCgpK1wiLVwiKyhwYXJzZUludChAbW9udGgudmFsKCksMTApKzEpLCBcIllZWVktTU1cIikuZGF5c0luTW9udGgoKSwgMTBcbiAgICAgIGlmIGRheT5kYXlzXG4gICAgICAgIEBkYXkudmFsIGRheXNcbiAgICAgICAgXG4gICAgICByZXR1cm5cblxuICAgIGlmIGRheT4zMVxuICAgICAgQGRheS52YWwgMzFcblxuICBkcm9wZWQ6IChldmVudCktPlxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICBGaWxlQVBJLmdldERyb3BGaWxlcyBldmVudCwgKGZpbGVzKS0+XG5cbiAgb3ZlcjogKG92ZXIpLT5cblxuXG4gIGRyb3A6IChmaWxlcyk9PlxuICAgIGlmIGZpbGVzLmxlbmd0aFxuICAgICAgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgXG4gICAgICByZWFkZXIub25sb2FkID0gKGV2ZW50KT0+XG4gICAgICAgIEBhdmF0YXJUZW1wbGF0ZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJ2ltZycpLnNyYyA9IGV2ZW50LnRhcmdldC5yZXN1bHRcbiAgICAgICAgYXZhdGFyID0gZG9jdW1lbnQuaW1wb3J0Tm9kZSBAYXZhdGFyVGVtcGxhdGUuY29udGVudCwgdHJ1ZVxuICAgICAgICBwcmV2ID0gQGZpbGVTZWxlY3Rvci5wcmV2KClcbiAgICAgICAgaWYgcHJldi5oYXNDbGFzcygnY3VycmVudC1hdmF0YXInKVxuICAgICAgICAgIHByZXYucmVtb3ZlKClcbiAgICAgICAgQGZpbGVTZWxlY3Rvci5iZWZvcmUgYXZhdGFyXG4gICAgICAgIEBmaWxlU2VsZWN0b3IucHJldigpLmZpbmQoJy5jbG9zZScpLm9uICdjbGljaycsIEByZW1vdmVBdmF0YXJcbiAgICAgIFxuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwgZmlsZXNbMF1cblxuICByZW1vdmVBdmF0YXI6IChldmVudCk9PlxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICBAZmlsZVNlbGVjdG9yLnByZXYoKS5yZW1vdmUoKVxuICAgIEBmaWxlLnJlcGxhY2VXaXRoIEBmaWxlLnZhbCgnJykuY2xvbmUodHJ1ZSlcbiAgICBAZmlsZSA9IEBmb3JtLmZpbmQgJyNyZWdpc3RyYXRpb24tYXZhdGFyJ1xuXG4gIGF2YXRhclNlbGVjdGVkOiAoZXZlbnQpPT5cbiAgICBmaWxlcyA9IEZpbGVBUEkuZ2V0RmlsZXMoZXZlbnQpXG5cbiAgICBleHQgPSBmaWxlc1swXVsnbmFtZSddLnN1YnN0cmluZyhmaWxlc1swXVsnbmFtZSddLmxhc3RJbmRleE9mKCcuJykgKyAxKS50b0xvd2VyQ2FzZSgpXG4gICAgaWYgKGZpbGVzWzBdICYmIChleHQgPT0gXCJnaWZcIiB8fCBleHQgPT0gXCJwbmdcIiB8fCBleHQgPT0gXCJqcGVnXCIgfHwgZXh0ID09IFwianBnXCIpKVxuICAgICAgICBcbiAgICAgIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKClcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpPT5cbiAgICAgICAgXG4gICAgICAgIEBhdmF0YXJUZW1wbGF0ZS5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoJ2ltZycpLnNyYyA9IGV2ZW50LnRhcmdldC5yZXN1bHRcbiAgICAgICAgYXZhdGFyID0gZG9jdW1lbnQuaW1wb3J0Tm9kZSBAYXZhdGFyVGVtcGxhdGUuY29udGVudCwgdHJ1ZVxuICAgICAgICBwcmV2ID0gQGZpbGVTZWxlY3Rvci5wcmV2KClcbiAgICAgICAgaWYgcHJldi5oYXNDbGFzcygnY3VycmVudC1hdmF0YXInKVxuICAgICAgICAgIHByZXYucmVtb3ZlKClcbiAgICAgICAgQGZpbGVTZWxlY3Rvci5iZWZvcmUgYXZhdGFyXG4gICAgICAgIEBmaWxlU2VsZWN0b3IucHJldigpLmZpbmQoJy5jbG9zZScpLm9uICdjbGljaycsIEByZW1vdmVBdmF0YXJcblxuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwgZmlsZXNbMF1cblxuXG4gIGFmdGVyQ2hlY2s6IChldmVudCk9PlxuICAgIFxuICAgIGlmIEBmb3JtLmZpbmQoJ2lucHV0LnVpLXN0YXRlLWVycm9yLCBzZWxlY3QudWktc3RhdGUtZXJyb3IsIHRleHRhcmVhLnVpLXN0YXRlLWVycm9yJykubGVuZ3RoID4gMFxuICAgICAgcmV0dXJuIGZhbHNlXG5cbiAgICBkcm9wX2Rvd25fZXJyID0gZmFsc2VcblxuICAgIGZvciBpbnB1dCBpbiBAZm9ybS5maW5kKCcuZHJvcGRvd24td2lkZ2V0JylcbiAgICAgIGlmICFpbnB1dC5jb250cm9sbGVyLnZhbGlkYXRlKClcbiAgICAgICAgZHJvcF9kb3duX2VyciA9IHRydWVcblxuICAgIGlmIGRyb3BfZG93bl9lcnJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgIHJldHVybiBmYWxzZVxuXG5cbiQoZG9jdW1lbnQpLnJlYWR5IC0+XG4gIG5ldyBQZXJzb25hbERhdGEoKSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==