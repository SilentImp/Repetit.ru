var PersonalData,__bind=function(e,t){return function(){return e.apply(t,arguments)}};PersonalData=function(){function e(){this.afterCheck=__bind(this.afterCheck,this),this.avatarSelected=__bind(this.avatarSelected,this),this.removeAvatar=__bind(this.removeAvatar,this),this.drop=__bind(this.drop,this),this.checkDate=__bind(this.checkDate,this);var e,t;if(this.form=$("form.panel"),1!==this.form.length)throw{error:"не найдена форма"};this.file=this.form.find("#registration-avatar"),this.avatarTemplate=document.getElementById("current-avatar-template"),this.fileSelector=$(".file-selector"),FileAPI.event.on(document.getElementById("registration-avatar"),"change",this.avatarSelected),$(document).dnd(this.over,this.drop),FileAPI.event.on(document,"drop",this.droped),this.form.h5Validate(),this.form.on("submit",this.afterCheck),this.mounth_widget=this.form.find(".month.dropdown-widget"),this.month=this.mounth_widget.find("select"),this.year_widget=this.form.find(".year.dropdown-widget"),this.year=this.year_widget.find("select"),this.day=this.form.find("input.day"),this.day.on("change",this.checkDate),this.month.on("change",this.checkDate),this.year.on("change",this.checkDate),e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("city"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:"https://dl.dropboxusercontent.com/u/20810772/citys.json"}),e.initialize(),$("#city").typeahead({hint:!0,highlight:!0,minLength:1},{name:"locations",displayKey:"city",source:e.ttAdapter(),templates:{suggestion:Handlebars.compile("<p><b>{{region}}</b>{{city}}</p>")}}),t=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.title)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[{title:"Andorra"},{title:"UnitedArabEmirates"},{title:"Afghanistan"},{title:"AntiguaandBarbuda"},{title:"Anguilla"},{title:"Albania"},{title:"Armenia"},{title:"Angola"},{title:"Antarctica"}]}),t.initialize(),$("#univercity").typeahead({hint:!0,highlight:!0,minLength:1},{name:"univercitys",displayKey:"title",source:t.ttAdapter(),templates:{suggestion:Handlebars.compile("<p>{{title}}</p>")}})}return e.prototype.checkDate=function(){var e,t;return e=parseInt(this.day.val().trim(),10),1>e||isNaN(e)?void this.day.val(1):this.mounth_widget.hasClass("unchanged")||this.year_widget.hasClass("unchanged")?e>31?this.day.val(31):void 0:(t=parseInt(moment(this.year.val()+"-"+(parseInt(this.month.val(),10)+1),"YYYY-MM").daysInMonth(),10),void(e>t&&this.day.val(t)))},e.prototype.droped=function(e){return e.preventDefault(),console.log("droped",e),FileAPI.getDropFiles(e,function(e){return console.log("file: ",e)})},e.prototype.over=function(){},e.prototype.drop=function(e){var t;return console.log("drop",e.length,e),e.length?(t=new FileReader,t.onload=function(e){return function(t){var i,r;return e.avatarTemplate.content.querySelector("img").src=t.target.result,i=document.importNode(e.avatarTemplate.content,!0),r=e.fileSelector.prev(),r.hasClass("current-avatar")&&r.remove(),e.fileSelector.before(i),e.fileSelector.prev().find(".close").on("click",e.removeAvatar)}}(this),t.readAsDataURL(e[0])):void 0},e.prototype.removeAvatar=function(e){return e.preventDefault(),this.fileSelector.prev().remove(),this.file.replaceWith(this.file.val("").clone(!0)),this.file=this.form.find("#registration-avatar")},e.prototype.avatarSelected=function(e){var t,i,r;return i=FileAPI.getFiles(e),t=i[0].name.substring(i[0].name.lastIndexOf(".")+1).toLowerCase(),!i[0]||"gif"!==t&&"png"!==t&&"jpeg"!==t&&"jpg"!==t?void 0:(r=new FileReader,r.onload=function(e){return function(t){var i,r;return e.avatarTemplate.content.querySelector("img").src=t.target.result,i=document.importNode(e.avatarTemplate.content,!0),r=e.fileSelector.prev(),r.hasClass("current-avatar")&&r.remove(),e.fileSelector.before(i),e.fileSelector.prev().find(".close").on("click",e.removeAvatar)}}(this),r.readAsDataURL(i[0]))},e.prototype.afterCheck=function(e){var t,i,r,a,n;if(this.form.find("input.ui-state-error, select.ui-state-error, textarea.ui-state-error").length>0)return!1;for(t=!1,n=this.form.find(".dropdown-widget"),r=0,a=n.length;a>r;r++)i=n[r],i.controller.validate()||(t=!0);return t?(e.preventDefault(),!1):void 0},e}(),$(document).ready(function(){return new PersonalData});
//# sourceMappingURL=data:application/json;base64,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U0FBUyxtQkFDZixFQUFLLFNBQ1AsRUFBQyxhQUFhLE9BQU8sR0FDckIsRUFBQyxhQUFhLE9BQU8sS0FBSyxVQUFVLEdBQUcsUUFBUyxFQUFDLGdCQVJuQyxNQVVoQixFQUFPLGNBQWMsRUFBTSxNQW5JL0IsRUFBQSxVQXNJQSxXQUFZLFNBQUMsR0FFWCxHQUFBLEdBQUEsRUFBQSxFQUFBLEVBQUEsQ0FBQSxJQUFHLEtBQUMsS0FBSyxLQUFLLHdFQUF3RSxPQUFTLEVBQzdGLE9BQU8sQ0FJVCxLQUZBLEdBQWdCLEVBRWhCLEVBQUEsS0FBQSxLQUFBLEtBQUEsb0JBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxXQUNLLEVBQU8sV0FBVyxhQUNuQixHQUFnQixFQUVwQixPQUFHLElBQ0QsRUFBTSxrQkFDQyxHQUZULGFBbEpKLEVBdUpFLFVBQVUsTUFBTSxpQkFDWixJQUFBIiwiZmlsZSI6IlBlcnNvbmFsRGF0YS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFBlcnNvbmFsRGF0YVxuICBjb25zdHJ1Y3RvcjogLT5cbiAgICBAZm9ybSA9ICQgJ2Zvcm0ucGFuZWwnXG4gICAgaWYgQGZvcm0ubGVuZ3RoICE9IDFcbiAgICAgIHRocm93IHtlcnJvcjogJ9C90LUg0L3QsNC50LTQtdC90LAg0YTQvtGA0LzQsCd9XG5cbiAgICBAZmlsZSA9IEBmb3JtLmZpbmQgJyNyZWdpc3RyYXRpb24tYXZhdGFyJ1xuICAgIEBhdmF0YXJUZW1wbGF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkICdjdXJyZW50LWF2YXRhci10ZW1wbGF0ZSdcbiAgICBAZmlsZVNlbGVjdG9yID0gJCAnLmZpbGUtc2VsZWN0b3InXG5cbiAgICBGaWxlQVBJLmV2ZW50Lm9uIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWdpc3RyYXRpb24tYXZhdGFyJyksICdjaGFuZ2UnLCBAYXZhdGFyU2VsZWN0ZWRcbiAgICAkKGRvY3VtZW50KS5kbmQgQG92ZXIsIEBkcm9wXG5cbiAgICBGaWxlQVBJLmV2ZW50Lm9uIGRvY3VtZW50LCAnZHJvcCcsIEBkcm9wZWRcblxuICAgIEBmb3JtLmg1VmFsaWRhdGUoKVxuICAgIEBmb3JtLm9uICdzdWJtaXQnLCBAYWZ0ZXJDaGVja1xuXG4gICAgQG1vdW50aF93aWRnZXQgPSBAZm9ybS5maW5kICcubW9udGguZHJvcGRvd24td2lkZ2V0J1xuICAgIEBtb250aCA9ICBAbW91bnRoX3dpZGdldC5maW5kICdzZWxlY3QnXG4gICAgQHllYXJfd2lkZ2V0ID0gQGZvcm0uZmluZCAnLnllYXIuZHJvcGRvd24td2lkZ2V0J1xuICAgIEB5ZWFyID0gIEB5ZWFyX3dpZGdldC5maW5kICdzZWxlY3QnXG4gICAgQGRheSA9IEBmb3JtLmZpbmQgJ2lucHV0LmRheSdcbiAgICBcbiAgICBAZGF5Lm9uICdjaGFuZ2UnLCBAY2hlY2tEYXRlXG4gICAgQG1vbnRoLm9uICdjaGFuZ2UnLCBAY2hlY2tEYXRlXG4gICAgQHllYXIub24gJ2NoYW5nZScsIEBjaGVja0RhdGVcblxuICAgIGxvY2F0aW9ucyA9IG5ldyBCbG9vZGhvdW5kXG4gICAgICBkYXR1bVRva2VuaXplcjogQmxvb2Rob3VuZC50b2tlbml6ZXJzLm9iai53aGl0ZXNwYWNlKFwiY2l0eVwiKSxcbiAgICAgIHF1ZXJ5VG9rZW5pemVyOiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZSxcbiAgICAgIHByZWZldGNoOiBcImh0dHBzOi8vZGwuZHJvcGJveHVzZXJjb250ZW50LmNvbS91LzIwODEwNzcyL2NpdHlzLmpzb25cIlxuICAgIFxuICAgIGxvY2F0aW9ucy5pbml0aWFsaXplKClcblxuICAgICQoJyNjaXR5JykudHlwZWFoZWFkXG4gICAgICBoaW50OiB0cnVlXG4gICAgICBoaWdobGlnaHQ6IHRydWVcbiAgICAgIG1pbkxlbmd0aDogMVxuICAgICxcbiAgICAgIG5hbWU6ICdsb2NhdGlvbnMnXG4gICAgICBkaXNwbGF5S2V5OiAnY2l0eScsXG4gICAgICBzb3VyY2U6IGxvY2F0aW9ucy50dEFkYXB0ZXIoKVxuICAgICAgdGVtcGxhdGVzOlxuICAgICAgICBzdWdnZXN0aW9uOiBIYW5kbGViYXJzLmNvbXBpbGUoJzxwPjxiPnt7cmVnaW9ufX08L2I+e3tjaXR5fX08L3A+JylcblxuICAgIHVuaXZlcmNpdHlzID0gbmV3IEJsb29kaG91bmRcbiAgICAgIGRhdHVtVG9rZW5pemVyOiAoZGF0YSktPlxuICAgICAgICByZXR1cm4gQmxvb2Rob3VuZC50b2tlbml6ZXJzLndoaXRlc3BhY2UoZGF0YS50aXRsZSlcbiAgICAgIHF1ZXJ5VG9rZW5pemVyOiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZSxcbiAgICAgIGxvY2FsOiBbe1widGl0bGVcIjpcIkFuZG9ycmFcIn0se1widGl0bGVcIjpcIlVuaXRlZEFyYWJFbWlyYXRlc1wifSx7XCJ0aXRsZVwiOlwiQWZnaGFuaXN0YW5cIn0se1widGl0bGVcIjpcIkFudGlndWFhbmRCYXJidWRhXCJ9LHtcInRpdGxlXCI6XCJBbmd1aWxsYVwifSx7XCJ0aXRsZVwiOlwiQWxiYW5pYVwifSx7XCJ0aXRsZVwiOlwiQXJtZW5pYVwifSx7XCJ0aXRsZVwiOlwiQW5nb2xhXCJ9LHtcInRpdGxlXCI6XCJBbnRhcmN0aWNhXCJ9XVxuXG4gICAgdW5pdmVyY2l0eXMuaW5pdGlhbGl6ZSgpXG5cbiAgICAkKCcjdW5pdmVyY2l0eScpLnR5cGVhaGVhZFxuICAgICAgaGludDogdHJ1ZVxuICAgICAgaGlnaGxpZ2h0OiB0cnVlXG4gICAgICBtaW5MZW5ndGg6IDFcbiAgICAsXG4gICAgICBuYW1lOiAndW5pdmVyY2l0eXMnXG4gICAgICBkaXNwbGF5S2V5OiAndGl0bGUnLFxuICAgICAgc291cmNlOiB1bml2ZXJjaXR5cy50dEFkYXB0ZXIoKVxuICAgICAgdGVtcGxhdGVzOlxuICAgICAgICBzdWdnZXN0aW9uOiBIYW5kbGViYXJzLmNvbXBpbGUoJzxwPnt7dGl0bGV9fTwvcD4nKVxuXG5cbiAgY2hlY2tEYXRlOiAoZXZlbnQpPT5cbiAgICBkYXkgPSBwYXJzZUludCBAZGF5LnZhbCgpLnRyaW0oKSwgMTBcblxuICAgIGlmIGRheTwxIHx8IGlzTmFOKGRheSlcbiAgICAgIEBkYXkudmFsIDFcbiAgICAgIHJldHVyblxuXG4gICAgaWYgIUBtb3VudGhfd2lkZ2V0Lmhhc0NsYXNzKCd1bmNoYW5nZWQnKSAmJiAhQHllYXJfd2lkZ2V0Lmhhc0NsYXNzKCd1bmNoYW5nZWQnKVxuXG4gICAgICBkYXlzID0gcGFyc2VJbnQgbW9tZW50KEB5ZWFyLnZhbCgpK1wiLVwiKyhwYXJzZUludChAbW9udGgudmFsKCksMTApKzEpLCBcIllZWVktTU1cIikuZGF5c0luTW9udGgoKSwgMTBcbiAgICAgIGlmIGRheT5kYXlzXG4gICAgICAgIEBkYXkudmFsIGRheXNcbiAgICAgICAgXG4gICAgICByZXR1cm5cblxuICAgIGlmIGRheT4zMVxuICAgICAgQGRheS52YWwgMzFcblxuICBkcm9wZWQ6IChldmVudCktPlxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICBjb25zb2xlLmxvZyAnZHJvcGVkJywgZXZlbnRcbiAgICBGaWxlQVBJLmdldERyb3BGaWxlcyBldmVudCwgKGZpbGVzKS0+XG4gICAgICBjb25zb2xlLmxvZyAnZmlsZTogJywgZmlsZXNcblxuICBvdmVyOiAob3ZlciktPlxuXG5cbiAgZHJvcDogKGZpbGVzKT0+XG4gICAgY29uc29sZS5sb2cgJ2Ryb3AnLCBmaWxlcy5sZW5ndGgsIGZpbGVzXG4gICAgaWYgZmlsZXMubGVuZ3RoXG4gICAgICByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXG4gICAgICBcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpPT5cbiAgICAgICAgQGF2YXRhclRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignaW1nJykuc3JjID0gZXZlbnQudGFyZ2V0LnJlc3VsdFxuICAgICAgICBhdmF0YXIgPSBkb2N1bWVudC5pbXBvcnROb2RlIEBhdmF0YXJUZW1wbGF0ZS5jb250ZW50LCB0cnVlXG4gICAgICAgIHByZXYgPSBAZmlsZVNlbGVjdG9yLnByZXYoKVxuICAgICAgICBpZiBwcmV2Lmhhc0NsYXNzKCdjdXJyZW50LWF2YXRhcicpXG4gICAgICAgICAgcHJldi5yZW1vdmUoKVxuICAgICAgICBAZmlsZVNlbGVjdG9yLmJlZm9yZSBhdmF0YXJcbiAgICAgICAgQGZpbGVTZWxlY3Rvci5wcmV2KCkuZmluZCgnLmNsb3NlJykub24gJ2NsaWNrJywgQHJlbW92ZUF2YXRhclxuICAgICAgXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCBmaWxlc1swXVxuXG4gIHJlbW92ZUF2YXRhcjogKGV2ZW50KT0+XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgIEBmaWxlU2VsZWN0b3IucHJldigpLnJlbW92ZSgpXG4gICAgQGZpbGUucmVwbGFjZVdpdGggQGZpbGUudmFsKCcnKS5jbG9uZSh0cnVlKVxuICAgIEBmaWxlID0gQGZvcm0uZmluZCAnI3JlZ2lzdHJhdGlvbi1hdmF0YXInXG5cbiAgYXZhdGFyU2VsZWN0ZWQ6IChldmVudCk9PlxuICAgIGZpbGVzID0gRmlsZUFQSS5nZXRGaWxlcyhldmVudClcblxuICAgIGV4dCA9IGZpbGVzWzBdWyduYW1lJ10uc3Vic3RyaW5nKGZpbGVzWzBdWyduYW1lJ10ubGFzdEluZGV4T2YoJy4nKSArIDEpLnRvTG93ZXJDYXNlKClcbiAgICBpZiAoZmlsZXNbMF0gJiYgKGV4dCA9PSBcImdpZlwiIHx8IGV4dCA9PSBcInBuZ1wiIHx8IGV4dCA9PSBcImpwZWdcIiB8fCBleHQgPT0gXCJqcGdcIikpXG4gICAgICAgIFxuICAgICAgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgcmVhZGVyLm9ubG9hZCA9IChldmVudCk9PlxuICAgICAgICBcbiAgICAgICAgQGF2YXRhclRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcignaW1nJykuc3JjID0gZXZlbnQudGFyZ2V0LnJlc3VsdFxuICAgICAgICBhdmF0YXIgPSBkb2N1bWVudC5pbXBvcnROb2RlIEBhdmF0YXJUZW1wbGF0ZS5jb250ZW50LCB0cnVlXG4gICAgICAgIHByZXYgPSBAZmlsZVNlbGVjdG9yLnByZXYoKVxuICAgICAgICBpZiBwcmV2Lmhhc0NsYXNzKCdjdXJyZW50LWF2YXRhcicpXG4gICAgICAgICAgcHJldi5yZW1vdmUoKVxuICAgICAgICBAZmlsZVNlbGVjdG9yLmJlZm9yZSBhdmF0YXJcbiAgICAgICAgQGZpbGVTZWxlY3Rvci5wcmV2KCkuZmluZCgnLmNsb3NlJykub24gJ2NsaWNrJywgQHJlbW92ZUF2YXRhclxuXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCBmaWxlc1swXVxuXG5cbiAgYWZ0ZXJDaGVjazogKGV2ZW50KT0+XG4gICAgXG4gICAgaWYgQGZvcm0uZmluZCgnaW5wdXQudWktc3RhdGUtZXJyb3IsIHNlbGVjdC51aS1zdGF0ZS1lcnJvciwgdGV4dGFyZWEudWktc3RhdGUtZXJyb3InKS5sZW5ndGggPiAwXG4gICAgICByZXR1cm4gZmFsc2VcblxuICAgIGRyb3BfZG93bl9lcnIgPSBmYWxzZVxuXG4gICAgZm9yIGlucHV0IGluIEBmb3JtLmZpbmQoJy5kcm9wZG93bi13aWRnZXQnKVxuICAgICAgaWYgIWlucHV0LmNvbnRyb2xsZXIudmFsaWRhdGUoKVxuICAgICAgICBkcm9wX2Rvd25fZXJyID0gdHJ1ZVxuXG4gICAgaWYgZHJvcF9kb3duX2VyclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgcmV0dXJuIGZhbHNlXG5cblxuJChkb2N1bWVudCkucmVhZHkgLT5cbiAgbmV3IFBlcnNvbmFsRGF0YSgpIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9